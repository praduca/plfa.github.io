<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Soundness: of reduction with respect to denotational semantics | Programming Language Foundations in Agda
</title><!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Soundness: of reduction with respect to denotational semantics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Programming Language Foundations in Agda" />
<meta property="og:description" content="Programming Language Foundations in Agda" />
<link rel="canonical" href="https://plfa.github.io/Soundness/" />
<meta property="og:url" content="https://plfa.github.io/Soundness/" />
<meta property="og:site_name" content="Programming Language Foundations in Agda" />
<script type="application/ld+json">
{"description":"Programming Language Foundations in Agda","@type":"WebPage","url":"https://plfa.github.io/Soundness/","headline":"Soundness: of reduction with respect to denotational semantics","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/">Programming Language Foundations in Agda
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/">Table of Contents</a>
                <a class="page-link" href="/GettingStarted/">Getting Started</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
      <h1 class="post-title">Soundness: of reduction with respect to denotational semantics</h1>
  </header>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


  <div class="post-content">
    <pre class="Agda"><a id="192" class="Keyword">module</a> <a id="199" href="/Soundness/" class="Module">plfa.Soundness</a> <a id="214" class="Keyword">where</a></pre>

<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="257" class="Keyword">open</a> <a id="262" class="Keyword">import</a> <a id="269" href="/Untyped/" class="Module">plfa.Untyped</a>
  <a id="284" class="Keyword">using</a> <a id="290" class="Symbol">(</a><a id="291" href="/Untyped/#2980" class="Datatype">Context</a><a id="298" class="Symbol">;</a> <a id="300" href="/Untyped/#3018" class="InductiveConstructor Operator">_,_</a><a id="303" class="Symbol">;</a> <a id="305" href="/Untyped/#3365" class="Datatype Operator">_∋_</a><a id="308" class="Symbol">;</a> <a id="310" href="/Untyped/#4150" class="Datatype Operator">_⊢_</a><a id="313" class="Symbol">;</a> <a id="315" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="316" class="Symbol">;</a> <a id="318" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="319" class="Symbol">;</a> <a id="321" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a><a id="323" class="Symbol">;</a> <a id="325" href="/Untyped/#4186" class="InductiveConstructor Operator">`_</a><a id="327" class="Symbol">;</a> <a id="329" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ_</a><a id="331" class="Symbol">;</a> <a id="333" href="/Untyped/#4298" class="InductiveConstructor Operator">_·_</a><a id="336" class="Symbol">;</a>
         <a id="347" href="/Untyped/#6931" class="Function">subst</a><a id="352" class="Symbol">;</a> <a id="354" href="/Untyped/#7475" class="Function Operator">_[_]</a><a id="358" class="Symbol">;</a> <a id="360" href="/Untyped/#7359" class="Function">subst-zero</a><a id="370" class="Symbol">;</a> <a id="372" href="/Untyped/#5845" class="Function">ext</a><a id="375" class="Symbol">;</a> <a id="377" href="/Untyped/#6171" class="Function">rename</a><a id="383" class="Symbol">;</a> <a id="385" href="/Untyped/#6623" class="Function">exts</a><a id="389" class="Symbol">)</a>
<a id="391" class="Keyword">open</a> <a id="396" class="Keyword">import</a> <a id="403" href="/LambdaReduction/" class="Module">plfa.LambdaReduction</a>
  <a id="426" class="Keyword">using</a> <a id="432" class="Symbol">(</a><a id="433" href="/LambdaReduction/#386" class="Datatype Operator">_—→_</a><a id="437" class="Symbol">;</a> <a id="439" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a><a id="441" class="Symbol">;</a> <a id="443" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a><a id="445" class="Symbol">;</a> <a id="447" href="/LambdaReduction/#616" class="InductiveConstructor">β</a><a id="448" class="Symbol">;</a> <a id="450" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a><a id="451" class="Symbol">;</a> <a id="453" href="/LambdaReduction/#894" class="Datatype Operator">_—↠_</a><a id="457" class="Symbol">;</a> <a id="459" href="/LambdaReduction/#1001" class="InductiveConstructor Operator">_—→⟨_⟩_</a><a id="466" class="Symbol">;</a> <a id="468" href="/LambdaReduction/#944" class="InductiveConstructor Operator">_[]</a><a id="471" class="Symbol">)</a>
<a id="473" class="Keyword">open</a> <a id="478" class="Keyword">import</a> <a id="485" href="/Denotational/" class="Module">plfa.Denotational</a>
<a id="503" class="Keyword">open</a> <a id="508" class="Keyword">import</a> <a id="515" href="/Compositional/" class="Module">plfa.Compositional</a>

<a id="535" class="Keyword">open</a> <a id="540" class="Keyword">import</a> <a id="547" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="587" class="Keyword">using</a> <a id="593" class="Symbol">(</a><a id="594" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a><a id="597" class="Symbol">;</a> <a id="599" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">_≢_</a><a id="602" class="Symbol">;</a> <a id="604" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="608" class="Symbol">;</a> <a id="610" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a><a id="613" class="Symbol">;</a> <a id="615" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1170" class="Function">cong</a><a id="619" class="Symbol">;</a> <a id="621" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1408" class="Function">cong₂</a><a id="626" class="Symbol">;</a> <a id="628" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1274" class="Function">cong-app</a><a id="636" class="Symbol">)</a>
<a id="638" class="Keyword">open</a> <a id="643" class="Keyword">import</a> <a id="650" href="https://agda.github.io/agda-stdlib/Data.Product.html" class="Module">Data.Product</a> <a id="663" class="Keyword">using</a> <a id="669" class="Symbol">(</a><a id="670" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">_×_</a><a id="673" class="Symbol">;</a> <a id="675" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#69" class="Record">Σ</a><a id="676" class="Symbol">;</a> <a id="678" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ-syntax</a><a id="686" class="Symbol">;</a> <a id="688" href="https://agda.github.io/agda-stdlib/Data.Product.html#881" class="Function">∃</a><a id="689" class="Symbol">;</a> <a id="691" href="https://agda.github.io/agda-stdlib/Data.Product.html#942" class="Function">∃-syntax</a><a id="699" class="Symbol">;</a> <a id="701" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#155" class="Field">proj₁</a><a id="706" class="Symbol">;</a> <a id="708" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#167" class="Field">proj₂</a><a id="713" class="Symbol">)</a>
  <a id="717" class="Keyword">renaming</a> <a id="726" class="Symbol">(</a><a id="727" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">_,_</a> <a id="731" class="Symbol">to</a> <a id="734" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="739" class="Symbol">)</a>
<a id="741" class="Keyword">open</a> <a id="746" class="Keyword">import</a> <a id="753" href="https://agda.github.io/agda-stdlib/Data.Sum.html" class="Module">Data.Sum</a>
<a id="762" class="Keyword">open</a> <a id="767" class="Keyword">import</a> <a id="774" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html" class="Module">Agda.Primitive</a> <a id="789" class="Keyword">using</a> <a id="795" class="Symbol">(</a><a id="796" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html#611" class="Primitive">lzero</a><a id="801" class="Symbol">)</a>
<a id="803" class="Keyword">open</a> <a id="808" class="Keyword">import</a> <a id="815" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="832" class="Keyword">using</a> <a id="838" class="Symbol">(</a><a id="839" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#464" class="Function Operator">¬_</a><a id="841" class="Symbol">)</a>
<a id="843" class="Keyword">open</a> <a id="848" class="Keyword">import</a> <a id="855" href="https://agda.github.io/agda-stdlib/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="881" class="Keyword">using</a> <a id="887" class="Symbol">(</a><a id="888" href="https://agda.github.io/agda-stdlib/Relation.Nullary.Negation.html#560" class="Function">contradiction</a><a id="901" class="Symbol">)</a>
<a id="903" class="Keyword">open</a> <a id="908" class="Keyword">import</a> <a id="915" href="https://agda.github.io/agda-stdlib/Data.Empty.html" class="Module">Data.Empty</a> <a id="926" class="Keyword">using</a> <a id="932" class="Symbol">(</a><a id="933" href="https://agda.github.io/agda-stdlib/Data.Empty.html#360" class="Function">⊥-elim</a><a id="939" class="Symbol">)</a>
<a id="941" class="Keyword">open</a> <a id="946" class="Keyword">import</a> <a id="953" href="https://agda.github.io/agda-stdlib/Data.Unit.html" class="Module">Data.Unit</a>
<a id="963" class="Keyword">open</a> <a id="968" class="Keyword">import</a> <a id="975" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="992" class="Keyword">using</a> <a id="998" class="Symbol">(</a><a id="999" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#534" class="Datatype">Dec</a><a id="1002" class="Symbol">;</a> <a id="1004" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a><a id="1007" class="Symbol">;</a> <a id="1009" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a><a id="1011" class="Symbol">)</a>
<a id="1013" class="Keyword">open</a> <a id="1018" class="Keyword">import</a> <a id="1025" href="https://agda.github.io/agda-stdlib/Function.html" class="Module">Function</a> <a id="1034" class="Keyword">using</a> <a id="1040" class="Symbol">(</a><a id="1041" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">_∘_</a><a id="1044" class="Symbol">)</a>
<a id="1046" class="Comment">-- open import plfa.Isomorphism using (extensionality)  -- causes a bug!</a></pre>

<p>In this chapter we prove that the reduction semantics is sound with
respect to the denotational semantics, i.e., for any term L</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>L —↠ ƛ N  implies  ℰ L ≃ ℰ (ƛ N)
</code></pre></div></div>

<p>The proof is by induction on the reduction sequence, so the main lemma
concerns a single reduction step. We prove that if any term <code class="highlighter-rouge">M</code> steps
to a term <code class="highlighter-rouge">N</code>, then <code class="highlighter-rouge">M</code> and <code class="highlighter-rouge">N</code> are denotationally equal. We shall
prove each direction of this if-and-only-if separately. One direction
will look just like a type preservation proof. The other direction is
like proving type preservation for reduction going in reverse.  Recall
that type preservation is sometimes called subject
reduction. Preservation in reverse is a well-known property and is
called <em>subject expansion</em>. It is also well-known that subject
expansion is false for most typed lambda calculi!</p>

<h2 id="forward-reduction-preserves-denotations">Forward reduction preserves denotations</h2>

<p>The proof of preservation in this section mixes techniques from
previous chapters. Like the proof of preservation for the STLC, we are
preserving a relation defined separately from the syntax, in contrast
to the inherently typed terms. On the other hand, we are using de
Bruijn indices for variables.</p>

<p>The outline of the proof remains the same in that we must prove lemmas
concerning all of the auxiliary functions used in the reduction
relation: substitution, renaming, and extension.</p>

<h3 id="simultaneous-substitution-preserves-denotations">Simultaneous substitution preserves denotations</h3>

<p>We introduce the following shorthand for the type of a substitution
from variables in context <code class="highlighter-rouge">Γ</code> to terms in context <code class="highlighter-rouge">Δ</code>.</p>

<pre class="Agda"><a id="Subst"></a><a id="2673" href="/Soundness/#2673" class="Function">Subst</a> <a id="2679" class="Symbol">:</a> <a id="2681" href="/Untyped/#2980" class="Datatype">Context</a> <a id="2689" class="Symbol">→</a> <a id="2691" href="/Untyped/#2980" class="Datatype">Context</a> <a id="2699" class="Symbol">→</a> <a id="2701" class="PrimitiveType">Set</a>
<a id="2705" href="/Soundness/#2673" class="Function">Subst</a> <a id="2711" href="/Soundness/#2711" class="Bound">Γ</a> <a id="2713" href="/Soundness/#2713" class="Bound">Δ</a> <a id="2715" class="Symbol">=</a> <a id="2717" class="Symbol">∀{</a><a id="2719" href="/Soundness/#2719" class="Bound">A</a><a id="2720" class="Symbol">}</a> <a id="2722" class="Symbol">→</a> <a id="2724" href="/Soundness/#2711" class="Bound">Γ</a> <a id="2726" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="2728" href="/Soundness/#2719" class="Bound">A</a> <a id="2730" class="Symbol">→</a> <a id="2732" href="/Soundness/#2713" class="Bound">Δ</a> <a id="2734" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="2736" href="/Soundness/#2719" class="Bound">A</a></pre>

<p>Our next goal is to prove that simultaneous substitution preserves
meaning.  That is, if <code class="highlighter-rouge">M</code> results in <code class="highlighter-rouge">v</code> in environment <code class="highlighter-rouge">γ</code>, then applying a
substitution <code class="highlighter-rouge">σ</code> to <code class="highlighter-rouge">M</code> gives us a program that also results in <code class="highlighter-rouge">v</code>, but in
an environment <code class="highlighter-rouge">δ</code> in which, for every variable <code class="highlighter-rouge">x</code>, <code class="highlighter-rouge">σ x</code> results in the
same value as the one for <code class="highlighter-rouge">x</code> in the original environment <code class="highlighter-rouge">γ</code>.
We write <code class="highlighter-rouge">δ ⊢ σ ↓ γ</code> for this condition.</p>

<pre class="Agda"><a id="3162" class="Keyword">infix</a> <a id="3168" class="Number">3</a> <a id="3170" href="/Soundness/#3177" class="Function Operator">_`⊢_↓_</a>
<a id="_`⊢_↓_"></a><a id="3177" href="/Soundness/#3177" class="Function Operator">_`⊢_↓_</a> <a id="3184" class="Symbol">:</a> <a id="3186" class="Symbol">∀{</a><a id="3188" href="/Soundness/#3188" class="Bound">Δ</a> <a id="3190" href="/Soundness/#3190" class="Bound">Γ</a><a id="3191" class="Symbol">}</a> <a id="3193" class="Symbol">→</a> <a id="3195" href="/Denotational/#7334" class="Function">Env</a> <a id="3199" href="/Soundness/#3188" class="Bound">Δ</a> <a id="3201" class="Symbol">→</a> <a id="3203" href="/Soundness/#2673" class="Function">Subst</a> <a id="3209" href="/Soundness/#3190" class="Bound">Γ</a> <a id="3211" href="/Soundness/#3188" class="Bound">Δ</a> <a id="3213" class="Symbol">→</a> <a id="3215" href="/Denotational/#7334" class="Function">Env</a> <a id="3219" href="/Soundness/#3190" class="Bound">Γ</a> <a id="3221" class="Symbol">→</a> <a id="3223" class="PrimitiveType">Set</a>
<a id="3227" href="/Soundness/#3177" class="Function Operator">_`⊢_↓_</a> <a id="3234" class="Symbol">{</a><a id="3235" href="/Soundness/#3235" class="Bound">Δ</a><a id="3236" class="Symbol">}{</a><a id="3238" href="/Soundness/#3238" class="Bound">Γ</a><a id="3239" class="Symbol">}</a> <a id="3241" href="/Soundness/#3241" class="Bound">δ</a> <a id="3243" href="/Soundness/#3243" class="Bound">σ</a> <a id="3245" href="/Soundness/#3245" class="Bound">γ</a> <a id="3247" class="Symbol">=</a> <a id="3249" class="Symbol">(∀</a> <a id="3252" class="Symbol">(</a><a id="3253" href="/Soundness/#3253" class="Bound">x</a> <a id="3255" class="Symbol">:</a> <a id="3257" href="/Soundness/#3238" class="Bound">Γ</a> <a id="3259" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="3261" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="3262" class="Symbol">)</a> <a id="3264" class="Symbol">→</a> <a id="3266" href="/Soundness/#3241" class="Bound">δ</a> <a id="3268" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="3270" href="/Soundness/#3243" class="Bound">σ</a> <a id="3272" href="/Soundness/#3253" class="Bound">x</a> <a id="3274" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="3276" href="/Soundness/#3245" class="Bound">γ</a> <a id="3278" href="/Soundness/#3253" class="Bound">x</a><a id="3279" class="Symbol">)</a></pre>

<p>As usual, to prepare for lambda abstraction, we prove an extension
lemma. It says that applying the <code class="highlighter-rouge">exts</code> function to a substitution
produces a new substitution that maps variables to terms that when
evaluated in <code class="highlighter-rouge">δ , v</code> produce the values in <code class="highlighter-rouge">γ , v</code>.</p>

<pre class="Agda"><a id="subst-ext"></a><a id="3560" href="/Soundness/#3560" class="Function">subst-ext</a> <a id="3570" class="Symbol">:</a> <a id="3572" class="Symbol">∀</a> <a id="3574" class="Symbol">{</a><a id="3575" href="/Soundness/#3575" class="Bound">Γ</a> <a id="3577" href="/Soundness/#3577" class="Bound">Δ</a> <a id="3579" href="/Soundness/#3579" class="Bound">v</a><a id="3580" class="Symbol">}</a> <a id="3582" class="Symbol">{</a><a id="3583" href="/Soundness/#3583" class="Bound">γ</a> <a id="3585" class="Symbol">:</a> <a id="3587" href="/Denotational/#7334" class="Function">Env</a> <a id="3591" href="/Soundness/#3575" class="Bound">Γ</a><a id="3592" class="Symbol">}</a> <a id="3594" class="Symbol">{</a><a id="3595" href="/Soundness/#3595" class="Bound">δ</a> <a id="3597" class="Symbol">:</a> <a id="3599" href="/Denotational/#7334" class="Function">Env</a> <a id="3603" href="/Soundness/#3577" class="Bound">Δ</a><a id="3604" class="Symbol">}</a>
  <a id="3608" class="Symbol">→</a> <a id="3610" class="Symbol">(</a><a id="3611" href="/Soundness/#3611" class="Bound">σ</a> <a id="3613" class="Symbol">:</a> <a id="3615" href="/Soundness/#2673" class="Function">Subst</a> <a id="3621" href="/Soundness/#3575" class="Bound">Γ</a> <a id="3623" href="/Soundness/#3577" class="Bound">Δ</a><a id="3624" class="Symbol">)</a>
  <a id="3628" class="Symbol">→</a> <a id="3630" href="/Soundness/#3595" class="Bound">δ</a> <a id="3632" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="3635" href="/Soundness/#3611" class="Bound">σ</a> <a id="3637" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="3639" href="/Soundness/#3583" class="Bound">γ</a>
   <a id="3644" class="Comment">--------------------------</a>
  <a id="3673" class="Symbol">→</a> <a id="3675" href="/Soundness/#3595" class="Bound">δ</a> <a id="3677" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="3680" href="/Soundness/#3579" class="Bound">v</a> <a id="3682" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="3685" href="/Untyped/#6623" class="Function">exts</a> <a id="3690" href="/Soundness/#3611" class="Bound">σ</a> <a id="3692" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="3694" href="/Soundness/#3583" class="Bound">γ</a> <a id="3696" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="3699" href="/Soundness/#3579" class="Bound">v</a>
<a id="3701" href="/Soundness/#3560" class="Function">subst-ext</a> <a id="3711" href="/Soundness/#3711" class="Bound">σ</a> <a id="3713" href="/Soundness/#3713" class="Bound">d</a> <a id="3715" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="3717" class="Symbol">=</a> <a id="3719" href="/Denotational/#9674" class="InductiveConstructor">var</a>
<a id="3723" href="/Soundness/#3560" class="Function">subst-ext</a> <a id="3733" href="/Soundness/#3733" class="Bound">σ</a> <a id="3735" href="/Soundness/#3735" class="Bound">d</a> <a id="3737" class="Symbol">(</a><a id="3738" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="3740" href="/Soundness/#3740" class="Bound">x′</a><a id="3742" class="Symbol">)</a> <a id="3744" class="Symbol">=</a> <a id="3746" href="/Denotational/#23897" class="Function">rename-pres</a> <a id="3758" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="3761" class="Symbol">(λ</a> <a id="3764" href="/Soundness/#3764" class="Bound">_</a> <a id="3766" class="Symbol">→</a> <a id="3768" href="/Denotational/#5641" class="Function">Refl⊑</a><a id="3773" class="Symbol">)</a> <a id="3775" class="Symbol">(</a><a id="3776" href="/Soundness/#3735" class="Bound">d</a> <a id="3778" href="/Soundness/#3740" class="Bound">x′</a><a id="3780" class="Symbol">)</a></pre>

<p>The proof is by cases on the de Bruijn index <code class="highlighter-rouge">x</code>.</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then we need to show that <code class="highlighter-rouge">δ , v ⊢ # 0 ↓ v</code>,
which we have by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x′</code>,then we need to show that 
<code class="highlighter-rouge">δ , v ⊢ rename S_ (σ x′) ↓ nth x′ γ</code>,
which we obtain by the <code class="highlighter-rouge">rename-pres</code> lemma.</p>
  </li>
</ul>

<p>With the extension lemma in hand, the proof that simultaneous
substitution preserves meaning is straightforward.  Let’s dive in!</p>

<pre class="Agda"><a id="subst-pres"></a><a id="4214" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="4225" class="Symbol">:</a> <a id="4227" class="Symbol">∀</a> <a id="4229" class="Symbol">{</a><a id="4230" href="/Soundness/#4230" class="Bound">Γ</a> <a id="4232" href="/Soundness/#4232" class="Bound">Δ</a> <a id="4234" href="/Soundness/#4234" class="Bound">v</a><a id="4235" class="Symbol">}</a> <a id="4237" class="Symbol">{</a><a id="4238" href="/Soundness/#4238" class="Bound">γ</a> <a id="4240" class="Symbol">:</a> <a id="4242" href="/Denotational/#7334" class="Function">Env</a> <a id="4246" href="/Soundness/#4230" class="Bound">Γ</a><a id="4247" class="Symbol">}</a> <a id="4249" class="Symbol">{</a><a id="4250" href="/Soundness/#4250" class="Bound">δ</a> <a id="4252" class="Symbol">:</a> <a id="4254" href="/Denotational/#7334" class="Function">Env</a> <a id="4258" href="/Soundness/#4232" class="Bound">Δ</a><a id="4259" class="Symbol">}</a> <a id="4261" class="Symbol">{</a><a id="4262" href="/Soundness/#4262" class="Bound">M</a> <a id="4264" class="Symbol">:</a> <a id="4266" href="/Soundness/#4230" class="Bound">Γ</a> <a id="4268" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="4270" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="4271" class="Symbol">}</a>
  <a id="4275" class="Symbol">→</a> <a id="4277" class="Symbol">(</a><a id="4278" href="/Soundness/#4278" class="Bound">σ</a> <a id="4280" class="Symbol">:</a> <a id="4282" href="/Soundness/#2673" class="Function">Subst</a> <a id="4288" href="/Soundness/#4230" class="Bound">Γ</a> <a id="4290" href="/Soundness/#4232" class="Bound">Δ</a><a id="4291" class="Symbol">)</a>
  <a id="4295" class="Symbol">→</a> <a id="4297" href="/Soundness/#4250" class="Bound">δ</a> <a id="4299" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="4302" href="/Soundness/#4278" class="Bound">σ</a> <a id="4304" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="4306" href="/Soundness/#4238" class="Bound">γ</a>
  <a id="4310" class="Symbol">→</a> <a id="4312" href="/Soundness/#4238" class="Bound">γ</a> <a id="4314" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="4316" href="/Soundness/#4262" class="Bound">M</a> <a id="4318" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="4320" href="/Soundness/#4234" class="Bound">v</a>
    <a id="4326" class="Comment">------------------</a>
  <a id="4347" class="Symbol">→</a> <a id="4349" href="/Soundness/#4250" class="Bound">δ</a> <a id="4351" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="4353" href="/Untyped/#6931" class="Function">subst</a> <a id="4359" href="/Soundness/#4278" class="Bound">σ</a> <a id="4361" href="/Soundness/#4262" class="Bound">M</a> <a id="4363" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="4365" href="/Soundness/#4234" class="Bound">v</a>
<a id="4367" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="4378" href="/Soundness/#4378" class="Bound">σ</a> <a id="4380" href="/Soundness/#4380" class="Bound">s</a> <a id="4382" class="Symbol">(</a><a id="4383" href="/Denotational/#9674" class="InductiveConstructor">var</a> <a id="4387" class="Symbol">{</a><a id="4388" class="Argument">x</a> <a id="4390" class="Symbol">=</a> <a id="4392" href="/Soundness/#4392" class="Bound">x</a><a id="4393" class="Symbol">})</a> <a id="4396" class="Symbol">=</a> <a id="4398" class="Symbol">(</a><a id="4399" href="/Soundness/#4380" class="Bound">s</a> <a id="4401" href="/Soundness/#4392" class="Bound">x</a><a id="4402" class="Symbol">)</a>
<a id="4404" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="4415" href="/Soundness/#4415" class="Bound">σ</a> <a id="4417" href="/Soundness/#4417" class="Bound">s</a> <a id="4419" class="Symbol">(</a><a id="4420" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="4427" href="/Soundness/#4427" class="Bound">d₁</a> <a id="4430" href="/Soundness/#4430" class="Bound">d₂</a><a id="4432" class="Symbol">)</a> <a id="4434" class="Symbol">=</a>
  <a id="4438" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="4445" class="Symbol">(</a><a id="4446" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="4457" href="/Soundness/#4415" class="Bound">σ</a> <a id="4459" href="/Soundness/#4417" class="Bound">s</a> <a id="4461" href="/Soundness/#4427" class="Bound">d₁</a><a id="4463" class="Symbol">)</a> <a id="4465" class="Symbol">(</a><a id="4466" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="4477" href="/Soundness/#4415" class="Bound">σ</a> <a id="4479" href="/Soundness/#4417" class="Bound">s</a> <a id="4481" href="/Soundness/#4430" class="Bound">d₂</a><a id="4483" class="Symbol">)</a> 
<a id="4486" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="4497" href="/Soundness/#4497" class="Bound">σ</a> <a id="4499" href="/Soundness/#4499" class="Bound">s</a> <a id="4501" class="Symbol">(</a><a id="4502" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="4510" href="/Soundness/#4510" class="Bound">d</a><a id="4511" class="Symbol">)</a> <a id="4513" class="Symbol">=</a>
  <a id="4517" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="4525" class="Symbol">(</a><a id="4526" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="4537" class="Symbol">(λ</a> <a id="4540" class="Symbol">{</a><a id="4541" href="/Soundness/#4541" class="Bound">A</a><a id="4542" class="Symbol">}</a> <a id="4544" class="Symbol">→</a> <a id="4546" href="/Untyped/#6623" class="Function">exts</a> <a id="4551" href="/Soundness/#4497" class="Bound">σ</a><a id="4552" class="Symbol">)</a> <a id="4554" class="Symbol">(</a><a id="4555" href="/Soundness/#3560" class="Function">subst-ext</a> <a id="4565" href="/Soundness/#4497" class="Bound">σ</a> <a id="4567" href="/Soundness/#4499" class="Bound">s</a><a id="4568" class="Symbol">)</a> <a id="4570" href="/Soundness/#4510" class="Bound">d</a><a id="4571" class="Symbol">)</a>
<a id="4573" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="4584" href="/Soundness/#4584" class="Bound">σ</a> <a id="4586" href="/Soundness/#4586" class="Bound">s</a> <a id="4588" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a> <a id="4596" class="Symbol">=</a> <a id="4598" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a>
<a id="4606" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="4617" href="/Soundness/#4617" class="Bound">σ</a> <a id="4619" href="/Soundness/#4619" class="Bound">s</a> <a id="4621" class="Symbol">(</a><a id="4622" href="/Denotational/#10090" class="InductiveConstructor">⊔-intro</a> <a id="4630" href="/Soundness/#4630" class="Bound">d₁</a> <a id="4633" href="/Soundness/#4633" class="Bound">d₂</a><a id="4635" class="Symbol">)</a> <a id="4637" class="Symbol">=</a>
  <a id="4641" href="/Denotational/#10090" class="InductiveConstructor">⊔-intro</a> <a id="4649" class="Symbol">(</a><a id="4650" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="4661" href="/Soundness/#4617" class="Bound">σ</a> <a id="4663" href="/Soundness/#4619" class="Bound">s</a> <a id="4665" href="/Soundness/#4630" class="Bound">d₁</a><a id="4667" class="Symbol">)</a> <a id="4669" class="Symbol">(</a><a id="4670" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="4681" href="/Soundness/#4617" class="Bound">σ</a> <a id="4683" href="/Soundness/#4619" class="Bound">s</a> <a id="4685" href="/Soundness/#4633" class="Bound">d₂</a><a id="4687" class="Symbol">)</a>
<a id="4689" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="4700" href="/Soundness/#4700" class="Bound">σ</a> <a id="4702" href="/Soundness/#4702" class="Bound">s</a> <a id="4704" class="Symbol">(</a><a id="4705" href="/Denotational/#10226" class="InductiveConstructor">sub</a> <a id="4709" href="/Soundness/#4709" class="Bound">d</a> <a id="4711" href="/Soundness/#4711" class="Bound">lt</a><a id="4713" class="Symbol">)</a> <a id="4715" class="Symbol">=</a> <a id="4717" href="/Denotational/#10226" class="InductiveConstructor">sub</a> <a id="4721" class="Symbol">(</a><a id="4722" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="4733" href="/Soundness/#4700" class="Bound">σ</a> <a id="4735" href="/Soundness/#4702" class="Bound">s</a> <a id="4737" href="/Soundness/#4709" class="Bound">d</a><a id="4738" class="Symbol">)</a> <a id="4740" href="/Soundness/#4711" class="Bound">lt</a></pre>

<p>The proof is by induction on the semantics of <code class="highlighter-rouge">M</code>.  The two interesting
cases are for variables and lambda abstractions.</p>

<ul>
  <li>
    <p>For a variable <code class="highlighter-rouge">x</code>, we have that <code class="highlighter-rouge">v ⊑ nth x γ</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ σ x ↓ v</code>.  From the premise applied to <code class="highlighter-rouge">x</code>, we have that
<code class="highlighter-rouge">δ ⊢ σ x ↓ nth x γ</code>, so we conclude by the <code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>For a lambda abstraction, we must extend the substitution
for the induction hypothesis. We apply the <code class="highlighter-rouge">subst-ext</code> lemma
to show that the extended substitution maps variables to
terms that result in the appropriate values.</p>
  </li>
</ul>

<h3 id="single-substitution-preserves-denotations">Single substitution preserves denotations</h3>

<p>For β reduction, <code class="highlighter-rouge">(ƛ N) · M —→ N [ M ]</code>, we need to show that the
semantics is preserved when substituting <code class="highlighter-rouge">M</code> for de Bruijn index 0 in
term <code class="highlighter-rouge">N</code>. By inversion on the rules <code class="highlighter-rouge">↦-elim</code> and <code class="highlighter-rouge">↦-intro</code>,
we have that <code class="highlighter-rouge">γ , v ⊢ M ↓ w</code> and <code class="highlighter-rouge">γ ⊢ N ↓ v</code>.
So we need to show that <code class="highlighter-rouge">γ ⊢ M [ N ] ↓ w</code>, or equivalently,
that <code class="highlighter-rouge">γ ⊢ subst (subst-zero N) M ↓ w</code>.</p>

<pre class="Agda"><a id="substitution"></a><a id="5706" href="/Soundness/#5706" class="Function">substitution</a> <a id="5719" class="Symbol">:</a> <a id="5721" class="Symbol">∀</a> <a id="5723" class="Symbol">{</a><a id="5724" href="/Soundness/#5724" class="Bound">Γ</a><a id="5725" class="Symbol">}</a> <a id="5727" class="Symbol">{</a><a id="5728" href="/Soundness/#5728" class="Bound">γ</a> <a id="5730" class="Symbol">:</a> <a id="5732" href="/Denotational/#7334" class="Function">Env</a> <a id="5736" href="/Soundness/#5724" class="Bound">Γ</a><a id="5737" class="Symbol">}</a> <a id="5739" class="Symbol">{</a><a id="5740" href="/Soundness/#5740" class="Bound">N</a> <a id="5742" href="/Soundness/#5742" class="Bound">M</a> <a id="5744" href="/Soundness/#5744" class="Bound">v</a> <a id="5746" href="/Soundness/#5746" class="Bound">w</a><a id="5747" class="Symbol">}</a>
   <a id="5752" class="Symbol">→</a> <a id="5754" href="/Soundness/#5728" class="Bound">γ</a> <a id="5756" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="5759" href="/Soundness/#5744" class="Bound">v</a> <a id="5761" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="5763" href="/Soundness/#5740" class="Bound">N</a> <a id="5765" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="5767" href="/Soundness/#5746" class="Bound">w</a>
   <a id="5772" class="Symbol">→</a> <a id="5774" href="/Soundness/#5728" class="Bound">γ</a> <a id="5776" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="5778" href="/Soundness/#5742" class="Bound">M</a> <a id="5780" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="5782" href="/Soundness/#5744" class="Bound">v</a>
     <a id="5789" class="Comment">---------------</a>
   <a id="5808" class="Symbol">→</a> <a id="5810" href="/Soundness/#5728" class="Bound">γ</a> <a id="5812" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="5814" href="/Soundness/#5740" class="Bound">N</a> <a id="5816" href="/Untyped/#7475" class="Function Operator">[</a> <a id="5818" href="/Soundness/#5742" class="Bound">M</a> <a id="5820" href="/Untyped/#7475" class="Function Operator">]</a> <a id="5822" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="5824" href="/Soundness/#5746" class="Bound">w</a>   
<a id="5829" href="/Soundness/#5706" class="Function">substitution</a><a id="5841" class="Symbol">{</a><a id="5842" href="/Soundness/#5842" class="Bound">Γ</a><a id="5843" class="Symbol">}{</a><a id="5845" href="/Soundness/#5845" class="Bound">γ</a><a id="5846" class="Symbol">}{</a><a id="5848" href="/Soundness/#5848" class="Bound">N</a><a id="5849" class="Symbol">}{</a><a id="5851" href="/Soundness/#5851" class="Bound">M</a><a id="5852" class="Symbol">}{</a><a id="5854" href="/Soundness/#5854" class="Bound">v</a><a id="5855" class="Symbol">}{</a><a id="5857" href="/Soundness/#5857" class="Bound">w</a><a id="5858" class="Symbol">}</a> <a id="5860" href="/Soundness/#5860" class="Bound">dn</a> <a id="5863" href="/Soundness/#5863" class="Bound">dm</a> <a id="5866" class="Symbol">=</a>
  <a id="5870" href="/Soundness/#4214" class="Function">subst-pres</a> <a id="5881" class="Symbol">(</a><a id="5882" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="5893" href="/Soundness/#5851" class="Bound">M</a><a id="5894" class="Symbol">)</a> <a id="5896" href="/Soundness/#5918" class="Function">sub-z-ok</a> <a id="5905" href="/Soundness/#5860" class="Bound">dn</a>
  <a id="5910" class="Keyword">where</a>
  <a id="5918" href="/Soundness/#5918" class="Function">sub-z-ok</a> <a id="5927" class="Symbol">:</a> <a id="5929" href="/Soundness/#5845" class="Bound">γ</a> <a id="5931" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="5934" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="5945" href="/Soundness/#5851" class="Bound">M</a> <a id="5947" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="5949" class="Symbol">(</a><a id="5950" href="/Soundness/#5845" class="Bound">γ</a> <a id="5952" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="5955" href="/Soundness/#5854" class="Bound">v</a><a id="5956" class="Symbol">)</a>
  <a id="5960" href="/Soundness/#5918" class="Function">sub-z-ok</a> <a id="5969" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="5971" class="Symbol">=</a> <a id="5973" href="/Soundness/#5863" class="Bound">dm</a>
  <a id="5978" href="/Soundness/#5918" class="Function">sub-z-ok</a> <a id="5987" class="Symbol">(</a><a id="5988" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="5990" href="/Soundness/#5990" class="Bound">x</a><a id="5991" class="Symbol">)</a> <a id="5993" class="Symbol">=</a> <a id="5995" href="/Denotational/#9674" class="InductiveConstructor">var</a></pre>

<p>This result is a corollary of the lemma for simultaneous substitution.
To use the lemma, we just need to show that <code class="highlighter-rouge">subst-zero M</code> maps
variables to terms that produces the same values as those in <code class="highlighter-rouge">γ , v</code>.
Let <code class="highlighter-rouge">y</code> be an arbitrary variable (de Bruijn index).</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then <code class="highlighter-rouge">(subst-zero M) y = M</code> and <code class="highlighter-rouge">nth y (γ , v) = v</code>.
By the premise we conclude that <code class="highlighter-rouge">γ ⊢ M ↓ v</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x</code>, then <code class="highlighter-rouge">(subst-zero M) (S x) = x</code> and
<code class="highlighter-rouge">nth (S x) (γ , v) = nth x γ</code>.  So we conclude that
<code class="highlighter-rouge">γ ⊢ x ↓ nth x γ</code> by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
</ul>

<h3 id="reduction-preserves-denotations">Reduction preserves denotations</h3>

<p>With the substitution lemma in hand, it is straightforward to prove
that reduction preserves denotations.</p>

<pre class="Agda"><a id="preserve"></a><a id="6688" href="/Soundness/#6688" class="Function">preserve</a> <a id="6697" class="Symbol">:</a> <a id="6699" class="Symbol">∀</a> <a id="6701" class="Symbol">{</a><a id="6702" href="/Soundness/#6702" class="Bound">Γ</a><a id="6703" class="Symbol">}</a> <a id="6705" class="Symbol">{</a><a id="6706" href="/Soundness/#6706" class="Bound">γ</a> <a id="6708" class="Symbol">:</a> <a id="6710" href="/Denotational/#7334" class="Function">Env</a> <a id="6714" href="/Soundness/#6702" class="Bound">Γ</a><a id="6715" class="Symbol">}</a> <a id="6717" class="Symbol">{</a><a id="6718" href="/Soundness/#6718" class="Bound">M</a> <a id="6720" href="/Soundness/#6720" class="Bound">N</a> <a id="6722" href="/Soundness/#6722" class="Bound">v</a><a id="6723" class="Symbol">}</a>
  <a id="6727" class="Symbol">→</a> <a id="6729" href="/Soundness/#6706" class="Bound">γ</a> <a id="6731" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="6733" href="/Soundness/#6718" class="Bound">M</a> <a id="6735" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="6737" href="/Soundness/#6722" class="Bound">v</a>
  <a id="6741" class="Symbol">→</a> <a id="6743" href="/Soundness/#6718" class="Bound">M</a> <a id="6745" href="/LambdaReduction/#386" class="Datatype Operator">—→</a> <a id="6748" href="/Soundness/#6720" class="Bound">N</a>
    <a id="6754" class="Comment">----------</a>
  <a id="6767" class="Symbol">→</a> <a id="6769" href="/Soundness/#6706" class="Bound">γ</a> <a id="6771" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="6773" href="/Soundness/#6720" class="Bound">N</a> <a id="6775" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="6777" href="/Soundness/#6722" class="Bound">v</a>
<a id="6779" href="/Soundness/#6688" class="Function">preserve</a> <a id="6788" class="Symbol">(</a><a id="6789" href="/Denotational/#9674" class="InductiveConstructor">var</a><a id="6792" class="Symbol">)</a> <a id="6794" class="Symbol">()</a>
<a id="6797" href="/Soundness/#6688" class="Function">preserve</a> <a id="6806" class="Symbol">(</a><a id="6807" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="6814" href="/Soundness/#6814" class="Bound">d₁</a> <a id="6817" href="/Soundness/#6817" class="Bound">d₂</a><a id="6819" class="Symbol">)</a> <a id="6821" class="Symbol">(</a><a id="6822" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="6825" href="/Soundness/#6825" class="Bound">r</a><a id="6826" class="Symbol">)</a> <a id="6828" class="Symbol">=</a> <a id="6830" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="6837" class="Symbol">(</a><a id="6838" href="/Soundness/#6688" class="Function">preserve</a> <a id="6847" href="/Soundness/#6814" class="Bound">d₁</a> <a id="6850" href="/Soundness/#6825" class="Bound">r</a><a id="6851" class="Symbol">)</a> <a id="6853" href="/Soundness/#6817" class="Bound">d₂</a> 
<a id="6857" href="/Soundness/#6688" class="Function">preserve</a> <a id="6866" class="Symbol">(</a><a id="6867" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="6874" href="/Soundness/#6874" class="Bound">d₁</a> <a id="6877" href="/Soundness/#6877" class="Bound">d₂</a><a id="6879" class="Symbol">)</a> <a id="6881" class="Symbol">(</a><a id="6882" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="6885" href="/Soundness/#6885" class="Bound">r</a><a id="6886" class="Symbol">)</a> <a id="6888" class="Symbol">=</a> <a id="6890" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="6897" href="/Soundness/#6874" class="Bound">d₁</a> <a id="6900" class="Symbol">(</a><a id="6901" href="/Soundness/#6688" class="Function">preserve</a> <a id="6910" href="/Soundness/#6877" class="Bound">d₂</a> <a id="6913" href="/Soundness/#6885" class="Bound">r</a><a id="6914" class="Symbol">)</a> 
<a id="6917" href="/Soundness/#6688" class="Function">preserve</a> <a id="6926" class="Symbol">(</a><a id="6927" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="6934" href="/Soundness/#6934" class="Bound">d₁</a> <a id="6937" href="/Soundness/#6937" class="Bound">d₂</a><a id="6939" class="Symbol">)</a> <a id="6941" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="6943" class="Symbol">=</a> <a id="6945" href="/Soundness/#5706" class="Function">substitution</a> <a id="6958" class="Symbol">(</a><a id="6959" href="/Compositional/#2952" class="Function">lambda-inversion</a> <a id="6976" href="/Soundness/#6934" class="Bound">d₁</a><a id="6978" class="Symbol">)</a> <a id="6980" href="/Soundness/#6937" class="Bound">d₂</a>
<a id="6983" href="/Soundness/#6688" class="Function">preserve</a> <a id="6992" class="Symbol">(</a><a id="6993" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="7001" href="/Soundness/#7001" class="Bound">d</a><a id="7002" class="Symbol">)</a> <a id="7004" class="Symbol">(</a><a id="7005" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="7007" href="/Soundness/#7007" class="Bound">r</a><a id="7008" class="Symbol">)</a> <a id="7010" class="Symbol">=</a> <a id="7012" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="7020" class="Symbol">(</a><a id="7021" href="/Soundness/#6688" class="Function">preserve</a> <a id="7030" href="/Soundness/#7001" class="Bound">d</a> <a id="7032" href="/Soundness/#7007" class="Bound">r</a><a id="7033" class="Symbol">)</a>
<a id="7035" href="/Soundness/#6688" class="Function">preserve</a> <a id="7044" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a> <a id="7052" href="/Soundness/#7052" class="Bound">r</a> <a id="7054" class="Symbol">=</a> <a id="7056" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a>
<a id="7064" href="/Soundness/#6688" class="Function">preserve</a> <a id="7073" class="Symbol">(</a><a id="7074" href="/Denotational/#10090" class="InductiveConstructor">⊔-intro</a> <a id="7082" href="/Soundness/#7082" class="Bound">d</a> <a id="7084" href="/Soundness/#7084" class="Bound">d₁</a><a id="7086" class="Symbol">)</a> <a id="7088" href="/Soundness/#7088" class="Bound">r</a> <a id="7090" class="Symbol">=</a> <a id="7092" href="/Denotational/#10090" class="InductiveConstructor">⊔-intro</a> <a id="7100" class="Symbol">(</a><a id="7101" href="/Soundness/#6688" class="Function">preserve</a> <a id="7110" href="/Soundness/#7082" class="Bound">d</a> <a id="7112" href="/Soundness/#7088" class="Bound">r</a><a id="7113" class="Symbol">)</a> <a id="7115" class="Symbol">(</a><a id="7116" href="/Soundness/#6688" class="Function">preserve</a> <a id="7125" href="/Soundness/#7084" class="Bound">d₁</a> <a id="7128" href="/Soundness/#7088" class="Bound">r</a><a id="7129" class="Symbol">)</a>
<a id="7131" href="/Soundness/#6688" class="Function">preserve</a> <a id="7140" class="Symbol">(</a><a id="7141" href="/Denotational/#10226" class="InductiveConstructor">sub</a> <a id="7145" href="/Soundness/#7145" class="Bound">d</a> <a id="7147" href="/Soundness/#7147" class="Bound">lt</a><a id="7149" class="Symbol">)</a> <a id="7151" href="/Soundness/#7151" class="Bound">r</a> <a id="7153" class="Symbol">=</a> <a id="7155" href="/Denotational/#10226" class="InductiveConstructor">sub</a> <a id="7159" class="Symbol">(</a><a id="7160" href="/Soundness/#6688" class="Function">preserve</a> <a id="7169" href="/Soundness/#7145" class="Bound">d</a> <a id="7171" href="/Soundness/#7151" class="Bound">r</a><a id="7172" class="Symbol">)</a> <a id="7174" href="/Soundness/#7147" class="Bound">lt</a></pre>

<p>We proceed by induction on the semantics of <code class="highlighter-rouge">M</code> with case analysis on
the reduction.</p>

<ul>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is a variable, then there is no such reduction.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is an application, then the reduction is either a congruence
(ξ₁ or ξ₂) or β. For each congruence, we use the induction
hypothesis. For β reduction we use the substitution lemma and the
<code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>The rest of the cases are straightforward.</p>
  </li>
</ul>

<h2 id="reduction-reflects-denotations">Reduction reflects denotations</h2>

<p>This section proves that reduction reflects the denotation of a
term. That is, if <code class="highlighter-rouge">N</code> results in <code class="highlighter-rouge">v</code>, and if <code class="highlighter-rouge">M</code> reduces to <code class="highlighter-rouge">N</code>, then
<code class="highlighter-rouge">M</code> also results in <code class="highlighter-rouge">v</code>. While there are some broad similarities
between this proof and the above proof of semantic preservation, we
shall require a few more technical lemmas to obtain this result.</p>

<p>The main challenge is dealing with the substitution in β reduction:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ƛ N) · M —→ N [ M ]
</code></pre></div></div>

<p>We have that <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code> and need to show that
<code class="highlighter-rouge">γ ⊢ (ƛ N) · M ↓ v</code>. Now consider the derivation of <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code>.
The term <code class="highlighter-rouge">M</code> may occur 0, 1, or many times inside <code class="highlighter-rouge">N [ M ]</code>. At each of
those occurences, <code class="highlighter-rouge">M</code> may result in a different value. But to build a
derivation for <code class="highlighter-rouge">(ƛ N) · M</code>, we need a single value for <code class="highlighter-rouge">M</code>.  If <code class="highlighter-rouge">M</code>
occured more than 1 time, then we can join all of the different values
using <code class="highlighter-rouge">⊔</code>. If <code class="highlighter-rouge">M</code> occured 0 times, then we do not need any information
about <code class="highlighter-rouge">M</code> and can therefore use <code class="highlighter-rouge">⊥</code> for the value of <code class="highlighter-rouge">M</code>.</p>

<h3 id="renaming-reflects-meaning">Renaming reflects meaning</h3>

<p>Previously we showed that renaming variables preserves meaning.  Now
we prove the opposite, that it reflects meaning. That is,
if <code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code>, where <code class="highlighter-rouge">(δ ∘ ρ) </code>⊑ γ`.</p>

<p>First, we need a variant of a lemma given earlier.</p>
<pre class="Agda"><a id="nth-ext"></a><a id="8880" href="/Soundness/#8880" class="Function">nth-ext</a> <a id="8888" class="Symbol">:</a> <a id="8890" class="Symbol">∀</a> <a id="8892" class="Symbol">{</a><a id="8893" href="/Soundness/#8893" class="Bound">Γ</a> <a id="8895" href="/Soundness/#8895" class="Bound">Δ</a> <a id="8897" href="/Soundness/#8897" class="Bound">v</a><a id="8898" class="Symbol">}</a> <a id="8900" class="Symbol">{</a><a id="8901" href="/Soundness/#8901" class="Bound">γ</a> <a id="8903" class="Symbol">:</a> <a id="8905" href="/Denotational/#7334" class="Function">Env</a> <a id="8909" href="/Soundness/#8893" class="Bound">Γ</a><a id="8910" class="Symbol">}</a> <a id="8912" class="Symbol">{</a><a id="8913" href="/Soundness/#8913" class="Bound">δ</a> <a id="8915" class="Symbol">:</a> <a id="8917" href="/Denotational/#7334" class="Function">Env</a> <a id="8921" href="/Soundness/#8895" class="Bound">Δ</a><a id="8922" class="Symbol">}</a>
  <a id="8926" class="Symbol">→</a> <a id="8928" class="Symbol">(</a><a id="8929" href="/Soundness/#8929" class="Bound">ρ</a> <a id="8931" class="Symbol">:</a> <a id="8933" href="/Denotational/#23035" class="Function">Rename</a> <a id="8940" href="/Soundness/#8893" class="Bound">Γ</a> <a id="8942" href="/Soundness/#8895" class="Bound">Δ</a><a id="8943" class="Symbol">)</a>
  <a id="8947" class="Symbol">→</a> <a id="8949" class="Symbol">(</a><a id="8950" href="/Soundness/#8913" class="Bound">δ</a> <a id="8952" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="8954" href="/Soundness/#8929" class="Bound">ρ</a><a id="8955" class="Symbol">)</a> <a id="8957" href="/Denotational/#8360" class="Function Operator">`⊑</a> <a id="8960" href="/Soundness/#8901" class="Bound">γ</a>
    <a id="8966" class="Comment">------------------------------</a>
  <a id="8999" class="Symbol">→</a> <a id="9001" class="Symbol">((</a><a id="9003" href="/Soundness/#8913" class="Bound">δ</a> <a id="9005" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="9008" href="/Soundness/#8897" class="Bound">v</a><a id="9009" class="Symbol">)</a> <a id="9011" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="9013" href="/Untyped/#5845" class="Function">ext</a> <a id="9017" href="/Soundness/#8929" class="Bound">ρ</a><a id="9018" class="Symbol">)</a> <a id="9020" href="/Denotational/#8360" class="Function Operator">`⊑</a> <a id="9023" class="Symbol">(</a><a id="9024" href="/Soundness/#8901" class="Bound">γ</a> <a id="9026" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="9029" href="/Soundness/#8897" class="Bound">v</a><a id="9030" class="Symbol">)</a>
<a id="9032" href="/Soundness/#8880" class="Function">nth-ext</a> <a id="9040" href="/Soundness/#9040" class="Bound">ρ</a> <a id="9042" href="/Soundness/#9042" class="Bound">lt</a> <a id="9045" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="9047" class="Symbol">=</a> <a id="9049" href="/Denotational/#5641" class="Function">Refl⊑</a>
<a id="9055" href="/Soundness/#8880" class="Function">nth-ext</a> <a id="9063" href="/Soundness/#9063" class="Bound">ρ</a> <a id="9065" href="/Soundness/#9065" class="Bound">lt</a> <a id="9068" class="Symbol">(</a><a id="9069" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="9071" href="/Soundness/#9071" class="Bound">x</a><a id="9072" class="Symbol">)</a> <a id="9074" class="Symbol">=</a> <a id="9076" href="/Soundness/#9065" class="Bound">lt</a> <a id="9079" href="/Soundness/#9071" class="Bound">x</a></pre>

<p>The proof is then as follows.</p>
<pre class="Agda"><a id="rename-reflect"></a><a id="9136" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9151" class="Symbol">:</a> <a id="9153" class="Symbol">∀</a> <a id="9155" class="Symbol">{</a><a id="9156" href="/Soundness/#9156" class="Bound">Γ</a> <a id="9158" href="/Soundness/#9158" class="Bound">Δ</a> <a id="9160" href="/Soundness/#9160" class="Bound">v</a><a id="9161" class="Symbol">}</a> <a id="9163" class="Symbol">{</a><a id="9164" href="/Soundness/#9164" class="Bound">γ</a> <a id="9166" class="Symbol">:</a> <a id="9168" href="/Denotational/#7334" class="Function">Env</a> <a id="9172" href="/Soundness/#9156" class="Bound">Γ</a><a id="9173" class="Symbol">}</a> <a id="9175" class="Symbol">{</a><a id="9176" href="/Soundness/#9176" class="Bound">δ</a> <a id="9178" class="Symbol">:</a> <a id="9180" href="/Denotational/#7334" class="Function">Env</a> <a id="9184" href="/Soundness/#9158" class="Bound">Δ</a><a id="9185" class="Symbol">}</a> <a id="9187" class="Symbol">{</a> <a id="9189" href="/Soundness/#9189" class="Bound">M</a> <a id="9191" class="Symbol">:</a> <a id="9193" href="/Soundness/#9156" class="Bound">Γ</a> <a id="9195" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="9197" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="9198" class="Symbol">}</a>
  <a id="9202" class="Symbol">→</a> <a id="9204" class="Symbol">{</a><a id="9205" href="/Soundness/#9205" class="Bound">ρ</a> <a id="9207" class="Symbol">:</a> <a id="9209" href="/Denotational/#23035" class="Function">Rename</a> <a id="9216" href="/Soundness/#9156" class="Bound">Γ</a> <a id="9218" href="/Soundness/#9158" class="Bound">Δ</a><a id="9219" class="Symbol">}</a>
  <a id="9223" class="Symbol">→</a> <a id="9225" class="Symbol">(</a><a id="9226" href="/Soundness/#9176" class="Bound">δ</a> <a id="9228" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="9230" href="/Soundness/#9205" class="Bound">ρ</a><a id="9231" class="Symbol">)</a> <a id="9233" href="/Denotational/#8360" class="Function Operator">`⊑</a> <a id="9236" href="/Soundness/#9164" class="Bound">γ</a>
  <a id="9240" class="Symbol">→</a> <a id="9242" href="/Soundness/#9176" class="Bound">δ</a> <a id="9244" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="9246" href="/Untyped/#6171" class="Function">rename</a> <a id="9253" href="/Soundness/#9205" class="Bound">ρ</a> <a id="9255" href="/Soundness/#9189" class="Bound">M</a> <a id="9257" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="9259" href="/Soundness/#9160" class="Bound">v</a>
    <a id="9265" class="Comment">------------------------------------</a>
  <a id="9304" class="Symbol">→</a> <a id="9306" href="/Soundness/#9164" class="Bound">γ</a> <a id="9308" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="9310" href="/Soundness/#9189" class="Bound">M</a> <a id="9312" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="9314" href="/Soundness/#9160" class="Bound">v</a>
<a id="9316" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9331" class="Symbol">{</a><a id="9332" class="Argument">M</a> <a id="9334" class="Symbol">=</a> <a id="9336" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="9338" href="/Soundness/#9338" class="Bound">x</a><a id="9339" class="Symbol">}</a> <a id="9341" href="/Soundness/#9341" class="Bound">all-n</a> <a id="9347" href="/Soundness/#9347" class="Bound">d</a> <a id="9349" class="Keyword">with</a> <a id="9354" href="/Compositional/#9007" class="Function">var-inv</a> <a id="9362" href="/Soundness/#9347" class="Bound">d</a>
<a id="9364" class="Symbol">...</a> <a id="9368" class="Symbol">|</a> <a id="9370" href="/Soundness/#9370" class="Bound">lt</a> <a id="9373" class="Symbol">=</a>  <a id="9376" href="/Denotational/#10226" class="InductiveConstructor">sub</a> <a id="9380" href="/Denotational/#9674" class="InductiveConstructor">var</a> <a id="9384" class="Symbol">(</a><a id="9385" href="/Denotational/#4768" class="InductiveConstructor">Trans⊑</a> <a id="9392" href="/Soundness/#9370" class="Bound">lt</a> <a id="9395" class="Symbol">(</a><a id="9396" class="Bound">all-n</a> <a id="9402" class="Bound">x</a><a id="9403" class="Symbol">))</a>
<a id="9406" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9421" class="Symbol">{</a><a id="9422" class="Argument">M</a> <a id="9424" class="Symbol">=</a> <a id="9426" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9428" href="/Soundness/#9428" class="Bound">N</a><a id="9429" class="Symbol">}{</a><a id="9431" class="Argument">ρ</a> <a id="9433" class="Symbol">=</a> <a id="9435" href="/Soundness/#9435" class="Bound">ρ</a><a id="9436" class="Symbol">}</a> <a id="9438" href="/Soundness/#9438" class="Bound">all-n</a> <a id="9444" class="Symbol">(</a><a id="9445" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="9453" href="/Soundness/#9453" class="Bound">d</a><a id="9454" class="Symbol">)</a> <a id="9456" class="Symbol">=</a>
   <a id="9461" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="9469" class="Symbol">(</a><a id="9470" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9485" class="Symbol">(</a><a id="9486" href="/Soundness/#8880" class="Function">nth-ext</a> <a id="9494" href="/Soundness/#9435" class="Bound">ρ</a> <a id="9496" href="/Soundness/#9438" class="Bound">all-n</a><a id="9501" class="Symbol">)</a> <a id="9503" href="/Soundness/#9453" class="Bound">d</a><a id="9504" class="Symbol">)</a>
<a id="9506" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9521" class="Symbol">{</a><a id="9522" class="Argument">M</a> <a id="9524" class="Symbol">=</a> <a id="9526" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9528" href="/Soundness/#9528" class="Bound">N</a><a id="9529" class="Symbol">}</a> <a id="9531" href="/Soundness/#9531" class="Bound">all-n</a> <a id="9537" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a> <a id="9545" class="Symbol">=</a> <a id="9547" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a>
<a id="9555" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9570" class="Symbol">{</a><a id="9571" class="Argument">M</a> <a id="9573" class="Symbol">=</a> <a id="9575" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9577" href="/Soundness/#9577" class="Bound">N</a><a id="9578" class="Symbol">}</a> <a id="9580" href="/Soundness/#9580" class="Bound">all-n</a> <a id="9586" class="Symbol">(</a><a id="9587" href="/Denotational/#10090" class="InductiveConstructor">⊔-intro</a> <a id="9595" href="/Soundness/#9595" class="Bound">d₁</a> <a id="9598" href="/Soundness/#9598" class="Bound">d₂</a><a id="9600" class="Symbol">)</a> <a id="9602" class="Symbol">=</a>
   <a id="9607" href="/Denotational/#10090" class="InductiveConstructor">⊔-intro</a> <a id="9615" class="Symbol">(</a><a id="9616" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9631" href="/Soundness/#9580" class="Bound">all-n</a> <a id="9637" href="/Soundness/#9595" class="Bound">d₁</a><a id="9639" class="Symbol">)</a> <a id="9641" class="Symbol">(</a><a id="9642" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9657" href="/Soundness/#9580" class="Bound">all-n</a> <a id="9663" href="/Soundness/#9598" class="Bound">d₂</a><a id="9665" class="Symbol">)</a>
<a id="9667" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9682" class="Symbol">{</a><a id="9683" class="Argument">M</a> <a id="9685" class="Symbol">=</a> <a id="9687" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9689" href="/Soundness/#9689" class="Bound">N</a><a id="9690" class="Symbol">}</a> <a id="9692" href="/Soundness/#9692" class="Bound">all-n</a> <a id="9698" class="Symbol">(</a><a id="9699" href="/Denotational/#10226" class="InductiveConstructor">sub</a> <a id="9703" href="/Soundness/#9703" class="Bound">d₁</a> <a id="9706" href="/Soundness/#9706" class="Bound">lt</a><a id="9708" class="Symbol">)</a> <a id="9710" class="Symbol">=</a>
   <a id="9715" href="/Denotational/#10226" class="InductiveConstructor">sub</a> <a id="9719" class="Symbol">(</a><a id="9720" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9735" href="/Soundness/#9692" class="Bound">all-n</a> <a id="9741" href="/Soundness/#9703" class="Bound">d₁</a><a id="9743" class="Symbol">)</a> <a id="9745" href="/Soundness/#9706" class="Bound">lt</a>
<a id="9748" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9763" class="Symbol">{</a><a id="9764" class="Argument">M</a> <a id="9766" class="Symbol">=</a> <a id="9768" href="/Soundness/#9768" class="Bound">L</a> <a id="9770" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9772" href="/Soundness/#9772" class="Bound">M</a><a id="9773" class="Symbol">}</a> <a id="9775" href="/Soundness/#9775" class="Bound">all-n</a> <a id="9781" class="Symbol">(</a><a id="9782" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="9789" href="/Soundness/#9789" class="Bound">d₁</a> <a id="9792" href="/Soundness/#9792" class="Bound">d₂</a><a id="9794" class="Symbol">)</a> <a id="9796" class="Symbol">=</a>
   <a id="9801" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="9808" class="Symbol">(</a><a id="9809" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9824" href="/Soundness/#9775" class="Bound">all-n</a> <a id="9830" href="/Soundness/#9789" class="Bound">d₁</a><a id="9832" class="Symbol">)</a> <a id="9834" class="Symbol">(</a><a id="9835" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9850" href="/Soundness/#9775" class="Bound">all-n</a> <a id="9856" href="/Soundness/#9792" class="Bound">d₂</a><a id="9858" class="Symbol">)</a> 
<a id="9861" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9876" class="Symbol">{</a><a id="9877" class="Argument">M</a> <a id="9879" class="Symbol">=</a> <a id="9881" href="/Soundness/#9881" class="Bound">L</a> <a id="9883" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9885" href="/Soundness/#9885" class="Bound">M</a><a id="9886" class="Symbol">}</a> <a id="9888" href="/Soundness/#9888" class="Bound">all-n</a> <a id="9894" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a> <a id="9902" class="Symbol">=</a> <a id="9904" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a>
<a id="9912" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9927" class="Symbol">{</a><a id="9928" class="Argument">M</a> <a id="9930" class="Symbol">=</a> <a id="9932" href="/Soundness/#9932" class="Bound">L</a> <a id="9934" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9936" href="/Soundness/#9936" class="Bound">M</a><a id="9937" class="Symbol">}</a> <a id="9939" href="/Soundness/#9939" class="Bound">all-n</a> <a id="9945" class="Symbol">(</a><a id="9946" href="/Denotational/#10090" class="InductiveConstructor">⊔-intro</a> <a id="9954" href="/Soundness/#9954" class="Bound">d₁</a> <a id="9957" href="/Soundness/#9957" class="Bound">d₂</a><a id="9959" class="Symbol">)</a> <a id="9961" class="Symbol">=</a>
   <a id="9966" href="/Denotational/#10090" class="InductiveConstructor">⊔-intro</a> <a id="9974" class="Symbol">(</a><a id="9975" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="9990" href="/Soundness/#9939" class="Bound">all-n</a> <a id="9996" href="/Soundness/#9954" class="Bound">d₁</a><a id="9998" class="Symbol">)</a> <a id="10000" class="Symbol">(</a><a id="10001" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="10016" href="/Soundness/#9939" class="Bound">all-n</a> <a id="10022" href="/Soundness/#9957" class="Bound">d₂</a><a id="10024" class="Symbol">)</a>
<a id="10026" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="10041" class="Symbol">{</a><a id="10042" class="Argument">M</a> <a id="10044" class="Symbol">=</a> <a id="10046" href="/Soundness/#10046" class="Bound">L</a> <a id="10048" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="10050" href="/Soundness/#10050" class="Bound">M</a><a id="10051" class="Symbol">}</a> <a id="10053" href="/Soundness/#10053" class="Bound">all-n</a> <a id="10059" class="Symbol">(</a><a id="10060" href="/Denotational/#10226" class="InductiveConstructor">sub</a> <a id="10064" href="/Soundness/#10064" class="Bound">d₁</a> <a id="10067" href="/Soundness/#10067" class="Bound">lt</a><a id="10069" class="Symbol">)</a> <a id="10071" class="Symbol">=</a>
   <a id="10076" href="/Denotational/#10226" class="InductiveConstructor">sub</a> <a id="10080" class="Symbol">(</a><a id="10081" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="10096" href="/Soundness/#10053" class="Bound">all-n</a> <a id="10102" href="/Soundness/#10064" class="Bound">d₁</a><a id="10104" class="Symbol">)</a> <a id="10106" href="/Soundness/#10067" class="Bound">lt</a></pre>

<p>We cannot prove this lemma by induction on the derivation of
<code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, so instead we proceed by induction on <code class="highlighter-rouge">M</code>.</p>

<ul>
  <li>
    <p>If it is a variable, we apply the inversion lemma to obtain
that <code class="highlighter-rouge">v ⊑ nth (ρ x) δ</code>. Instantiating the premise to <code class="highlighter-rouge">x</code> we have
<code class="highlighter-rouge">nth (ρ x) δ = nth x γ</code>, so we conclude by the <code class="highlighter-rouge">var</code> rule.</p>
  </li>
  <li>
    <p>If it is a lambda abstraction <code class="highlighter-rouge">ƛ N</code>, we have
rename <code class="highlighter-rouge">ρ (ƛ N) = ƛ (rename (ext ρ) N)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ ƛ (rename (ext ρ) N) ↓ v</code>.</p>

    <ul>
      <li>
        <p>Rule <code class="highlighter-rouge">↦-intro</code>: To satisfy the premise of the induction
hypothesis, we prove that the renaming can be extended to be a
mapping from <code class="highlighter-rouge">γ , v₁ to δ , v₁</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊥-intro</code>: We simply apply <code class="highlighter-rouge">⊥-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊔-intro</code>: We apply the induction hypotheses and <code class="highlighter-rouge">⊔-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">sub</code>: We apply the induction hypothesis and <code class="highlighter-rouge">sub</code>.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>If it is an application <code class="highlighter-rouge">L · M</code>, we have
<code class="highlighter-rouge">rename ρ (L · M) = (rename ρ L) · (rename ρ M)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ (rename ρ L) · (rename ρ M) ↓ v</code>
and all the cases are straightforward.</p>
  </li>
</ul>

<p>In the upcoming uses of <code class="highlighter-rouge">rename-reflect</code>, the renaming will always be
the increment function. So we prove a corollary for that special case.</p>

<pre class="Agda"><a id="rename-inc-reflect"></a><a id="11287" href="/Soundness/#11287" class="Function">rename-inc-reflect</a> <a id="11306" class="Symbol">:</a> <a id="11308" class="Symbol">∀</a> <a id="11310" class="Symbol">{</a><a id="11311" href="/Soundness/#11311" class="Bound">Γ</a> <a id="11313" href="/Soundness/#11313" class="Bound">v′</a> <a id="11316" href="/Soundness/#11316" class="Bound">v</a><a id="11317" class="Symbol">}</a> <a id="11319" class="Symbol">{</a><a id="11320" href="/Soundness/#11320" class="Bound">γ</a> <a id="11322" class="Symbol">:</a> <a id="11324" href="/Denotational/#7334" class="Function">Env</a> <a id="11328" href="/Soundness/#11311" class="Bound">Γ</a><a id="11329" class="Symbol">}</a> <a id="11331" class="Symbol">{</a> <a id="11333" href="/Soundness/#11333" class="Bound">M</a> <a id="11335" class="Symbol">:</a> <a id="11337" href="/Soundness/#11311" class="Bound">Γ</a> <a id="11339" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="11341" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="11342" class="Symbol">}</a>
  <a id="11346" class="Symbol">→</a> <a id="11348" class="Symbol">(</a><a id="11349" href="/Soundness/#11320" class="Bound">γ</a> <a id="11351" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="11354" href="/Soundness/#11313" class="Bound">v′</a><a id="11356" class="Symbol">)</a> <a id="11358" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="11360" href="/Untyped/#6171" class="Function">rename</a> <a id="11367" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="11370" href="/Soundness/#11333" class="Bound">M</a> <a id="11372" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="11374" href="/Soundness/#11316" class="Bound">v</a>
    <a id="11380" class="Comment">----------------------------</a>
  <a id="11411" class="Symbol">→</a> <a id="11413" href="/Soundness/#11320" class="Bound">γ</a> <a id="11415" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="11417" href="/Soundness/#11333" class="Bound">M</a> <a id="11419" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="11421" href="/Soundness/#11316" class="Bound">v</a>
<a id="11423" href="/Soundness/#11287" class="Function">rename-inc-reflect</a> <a id="11442" href="/Soundness/#11442" class="Bound">d</a> <a id="11444" class="Symbol">=</a> <a id="11446" href="/Soundness/#9136" class="Function">rename-reflect</a> <a id="11461" href="/Denotational/#8878" class="Function">`Refl⊑</a> <a id="11468" href="/Soundness/#11442" class="Bound">d</a></pre>

<h3 id="substitution-reflects-denotations-the-variable-case">Substitution reflects denotations, the variable case</h3>

<p>We are almost ready to begin proving that simultaneous substitution
reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ (subst σ M) ↓ v</code>, then
<code class="highlighter-rouge">γ ⊢ σ k ↓ nth k δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code> and some <code class="highlighter-rouge">δ</code>.
We shall start with the case in which <code class="highlighter-rouge">M</code> is a variable <code class="highlighter-rouge">x</code>.
So instead the premise is <code class="highlighter-rouge">γ ⊢ σ x ↓ v</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ x ↓ v</code> for some <code class="highlighter-rouge">δ</code>. The <code class="highlighter-rouge">δ</code> that we choose shall be the
environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other variable to <code class="highlighter-rouge">⊥</code>.</p>

<p>The nth element of the `⊥ environment is always ⊥.
[PLW: Probably can omit]</p>
<pre class="Agda"><a id="nth-`⊥"></a><a id="12077" href="/Soundness/#12077" class="Function">nth-`⊥</a> <a id="12084" class="Symbol">:</a> <a id="12086" class="Symbol">∀{</a><a id="12088" href="/Soundness/#12088" class="Bound">Γ</a><a id="12089" class="Symbol">}</a> <a id="12091" class="Symbol">{</a><a id="12092" href="/Soundness/#12092" class="Bound">x</a> <a id="12094" class="Symbol">:</a> <a id="12096" href="/Soundness/#12088" class="Bound">Γ</a> <a id="12098" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12100" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12101" class="Symbol">}</a> <a id="12103" class="Symbol">→</a> <a id="12105" href="/Denotational/#8579" class="Function">`⊥</a> <a id="12108" href="/Soundness/#12092" class="Bound">x</a> <a id="12110" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12112" href="/Denotational/#4120" class="InductiveConstructor">⊥</a>
<a id="12114" href="/Soundness/#12077" class="Function">nth-`⊥</a> <a id="12121" class="Symbol">{</a><a id="12122" class="Argument">x</a> <a id="12124" class="Symbol">=</a> <a id="12126" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="12127" class="Symbol">}</a> <a id="12129" class="Symbol">=</a> <a id="12131" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12136" href="/Soundness/#12077" class="Function">nth-`⊥</a> <a id="12143" class="Symbol">{</a><a id="12144" href="/Soundness/#12144" class="Bound">Γ</a> <a id="12146" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="12148" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12149" class="Symbol">}</a> <a id="12151" class="Symbol">{</a><a id="12152" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12154" href="/Soundness/#12154" class="Bound">x</a><a id="12155" class="Symbol">}</a> <a id="12157" class="Symbol">=</a> <a id="12159" href="/Soundness/#12077" class="Function">nth-`⊥</a> <a id="12166" class="Symbol">{</a><a id="12167" href="/Soundness/#12144" class="Bound">Γ</a><a id="12168" class="Symbol">}</a> <a id="12170" class="Symbol">{</a><a id="12171" href="/Soundness/#12154" class="Bound">x</a><a id="12172" class="Symbol">}</a></pre>

<p>Next we define the environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other
variable to <code class="highlighter-rouge">⊥</code>, that is <code class="highlighter-rouge">const-env x v</code>.</p>

<pre class="Agda"><a id="12310" class="Comment">{-
inv-S : ∀ {Γ A B} {x y : Γ ∋ A}
  → _≡_ {_} {Γ , B ∋ A} (S x) (S y)
  → S x ≡ S y
    -------------------------------
  → x ≡ y
inv-S refl = refl
-}</a>

<a id="_var≟_"></a><a id="12463" href="/Soundness/#12463" class="Function Operator">_var≟_</a> <a id="12470" class="Symbol">:</a> <a id="12472" class="Symbol">∀</a> <a id="12474" class="Symbol">{</a><a id="12475" href="/Soundness/#12475" class="Bound">Γ</a><a id="12476" class="Symbol">}</a> <a id="12478" class="Symbol">→</a> <a id="12480" class="Symbol">(</a><a id="12481" href="/Soundness/#12481" class="Bound">x</a> <a id="12483" href="/Soundness/#12483" class="Bound">y</a> <a id="12485" class="Symbol">:</a> <a id="12487" href="/Soundness/#12475" class="Bound">Γ</a> <a id="12489" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12491" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12492" class="Symbol">)</a> <a id="12494" class="Symbol">→</a> <a id="12496" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#534" class="Datatype">Dec</a> <a id="12500" class="Symbol">(</a><a id="12501" href="/Soundness/#12481" class="Bound">x</a> <a id="12503" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12505" href="/Soundness/#12483" class="Bound">y</a><a id="12506" class="Symbol">)</a>
<a id="12508" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12510" href="/Soundness/#12463" class="Function Operator">var≟</a> <a id="12515" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12518" class="Symbol">=</a>  <a id="12521" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12525" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12530" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12532" href="/Soundness/#12463" class="Function Operator">var≟</a> <a id="12537" class="Symbol">(</a><a id="12538" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12540" class="Symbol">_)</a>  <a id="12544" class="Symbol">=</a>  <a id="12547" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12550" class="Symbol">λ()</a>
<a id="12554" class="Symbol">(</a><a id="12555" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12557" class="Symbol">_)</a> <a id="12560" href="/Soundness/#12463" class="Function Operator">var≟</a> <a id="12565" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12568" class="Symbol">=</a>  <a id="12571" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12574" class="Symbol">λ()</a>
<a id="12578" class="Symbol">(</a><a id="12579" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12581" href="/Soundness/#12581" class="Bound">x</a><a id="12582" class="Symbol">)</a> <a id="12584" href="/Soundness/#12463" class="Function Operator">var≟</a> <a id="12589" class="Symbol">(</a><a id="12590" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12592" href="/Soundness/#12592" class="Bound">y</a><a id="12593" class="Symbol">)</a> <a id="12595" class="Keyword">with</a>  <a id="12601" href="/Soundness/#12581" class="Bound">x</a> <a id="12603" href="/Soundness/#12463" class="Function Operator">var≟</a> <a id="12608" href="/Soundness/#12592" class="Bound">y</a>
<a id="12610" class="Symbol">...</a>                 <a id="12630" class="Symbol">|</a>  <a id="12633" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12637" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12642" class="Symbol">=</a>  <a id="12645" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12649" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12654" class="Symbol">...</a>                 <a id="12674" class="Symbol">|</a>  <a id="12677" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12680" href="/Soundness/#12680" class="Bound">neq</a>   <a id="12686" class="Symbol">=</a>  <a id="12689" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12692" class="Symbol">λ{</a><a id="12694" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12699" class="Symbol">→</a> <a id="12701" href="/Soundness/#12680" class="Bound">neq</a> <a id="12705" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="12709" class="Symbol">}</a>

<a id="var≟-refl"></a><a id="12712" href="/Soundness/#12712" class="Function">var≟-refl</a> <a id="12722" class="Symbol">:</a> <a id="12724" class="Symbol">∀</a> <a id="12726" class="Symbol">{</a><a id="12727" href="/Soundness/#12727" class="Bound">Γ</a><a id="12728" class="Symbol">}</a> <a id="12730" class="Symbol">(</a><a id="12731" href="/Soundness/#12731" class="Bound">x</a> <a id="12733" class="Symbol">:</a> <a id="12735" href="/Soundness/#12727" class="Bound">Γ</a> <a id="12737" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12739" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12740" class="Symbol">)</a> <a id="12742" class="Symbol">→</a> <a id="12744" class="Symbol">(</a><a id="12745" href="/Soundness/#12731" class="Bound">x</a> <a id="12747" href="/Soundness/#12463" class="Function Operator">var≟</a> <a id="12752" href="/Soundness/#12731" class="Bound">x</a><a id="12753" class="Symbol">)</a> <a id="12755" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12757" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12761" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12766" href="/Soundness/#12712" class="Function">var≟-refl</a> <a id="12776" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12778" class="Symbol">=</a> <a id="12780" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12785" href="/Soundness/#12712" class="Function">var≟-refl</a> <a id="12795" class="Symbol">(</a><a id="12796" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12798" href="/Soundness/#12798" class="Bound">x</a><a id="12799" class="Symbol">)</a> <a id="12801" class="Keyword">rewrite</a> <a id="12809" href="/Soundness/#12712" class="Function">var≟-refl</a> <a id="12819" href="/Soundness/#12798" class="Bound">x</a> <a id="12821" class="Symbol">=</a> <a id="12823" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>

<a id="const-env"></a><a id="12829" href="/Soundness/#12829" class="Function">const-env</a> <a id="12839" class="Symbol">:</a> <a id="12841" class="Symbol">∀{</a><a id="12843" href="/Soundness/#12843" class="Bound">Γ</a><a id="12844" class="Symbol">}</a> <a id="12846" class="Symbol">→</a> <a id="12848" class="Symbol">(</a><a id="12849" href="/Soundness/#12849" class="Bound">x</a> <a id="12851" class="Symbol">:</a> <a id="12853" href="/Soundness/#12843" class="Bound">Γ</a> <a id="12855" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12857" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12858" class="Symbol">)</a> <a id="12860" class="Symbol">→</a> <a id="12862" href="/Denotational/#4100" class="Datatype">Value</a> <a id="12868" class="Symbol">→</a> <a id="12870" href="/Denotational/#7334" class="Function">Env</a> <a id="12874" href="/Soundness/#12843" class="Bound">Γ</a>
<a id="12876" href="/Soundness/#12829" class="Function">const-env</a> <a id="12886" href="/Soundness/#12886" class="Bound">x</a> <a id="12888" href="/Soundness/#12888" class="Bound">v</a> <a id="12890" href="/Soundness/#12890" class="Bound">y</a> <a id="12892" class="Keyword">with</a> <a id="12897" href="/Soundness/#12886" class="Bound">x</a> <a id="12899" href="/Soundness/#12463" class="Function Operator">var≟</a> <a id="12904" href="/Soundness/#12890" class="Bound">y</a>
<a id="12906" class="Symbol">...</a>             <a id="12922" class="Symbol">|</a> <a id="12924" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12928" class="Symbol">_</a>       <a id="12936" class="Symbol">=</a> <a id="12938" class="Bound">v</a>
<a id="12940" class="Symbol">...</a>             <a id="12956" class="Symbol">|</a> <a id="12958" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12961" class="Symbol">_</a>        <a id="12970" class="Symbol">=</a> <a id="12972" href="/Denotational/#4120" class="InductiveConstructor">⊥</a></pre>

<p>Of course, the nth element of <code class="highlighter-rouge">const-env n v</code> is the value <code class="highlighter-rouge">v</code>.</p>

<pre class="Agda"><a id="nth-const-env"></a><a id="13064" href="/Soundness/#13064" class="Function">nth-const-env</a> <a id="13078" class="Symbol">:</a> <a id="13080" class="Symbol">∀{</a><a id="13082" href="/Soundness/#13082" class="Bound">Γ</a><a id="13083" class="Symbol">}</a> <a id="13085" class="Symbol">{</a><a id="13086" href="/Soundness/#13086" class="Bound">x</a> <a id="13088" class="Symbol">:</a> <a id="13090" href="/Soundness/#13082" class="Bound">Γ</a> <a id="13092" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="13094" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="13095" class="Symbol">}</a> <a id="13097" class="Symbol">{</a><a id="13098" href="/Soundness/#13098" class="Bound">v</a><a id="13099" class="Symbol">}</a> <a id="13101" class="Symbol">→</a> <a id="13103" class="Symbol">(</a><a id="13104" href="/Soundness/#12829" class="Function">const-env</a> <a id="13114" href="/Soundness/#13086" class="Bound">x</a> <a id="13116" href="/Soundness/#13098" class="Bound">v</a><a id="13117" class="Symbol">)</a> <a id="13119" href="/Soundness/#13086" class="Bound">x</a> <a id="13121" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="13123" href="/Soundness/#13098" class="Bound">v</a>
<a id="13125" href="/Soundness/#13064" class="Function">nth-const-env</a> <a id="13139" class="Symbol">{</a><a id="13140" class="Argument">x</a> <a id="13142" class="Symbol">=</a> <a id="13144" href="/Soundness/#13144" class="Bound">x</a><a id="13145" class="Symbol">}</a> <a id="13147" class="Keyword">rewrite</a> <a id="13155" href="/Soundness/#12712" class="Function">var≟-refl</a> <a id="13165" href="/Soundness/#13144" class="Bound">x</a> <a id="13167" class="Symbol">=</a> <a id="13169" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>The nth element of <code class="highlighter-rouge">const-env n′ v</code> is the value <code class="highlighter-rouge">⊥, so long as </code>n ≢ n′`.</p>

<pre class="Agda"><a id="diff-nth-const-env"></a><a id="13274" href="/Soundness/#13274" class="Function">diff-nth-const-env</a> <a id="13293" class="Symbol">:</a> <a id="13295" class="Symbol">∀{</a><a id="13297" href="/Soundness/#13297" class="Bound">Γ</a><a id="13298" class="Symbol">}</a> <a id="13300" class="Symbol">{</a><a id="13301" href="/Soundness/#13301" class="Bound">x</a> <a id="13303" href="/Soundness/#13303" class="Bound">y</a> <a id="13305" class="Symbol">:</a> <a id="13307" href="/Soundness/#13297" class="Bound">Γ</a> <a id="13309" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="13311" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="13312" class="Symbol">}</a> <a id="13314" class="Symbol">{</a><a id="13315" href="/Soundness/#13315" class="Bound">v</a><a id="13316" class="Symbol">}</a>
  <a id="13320" class="Symbol">→</a> <a id="13322" href="/Soundness/#13301" class="Bound">x</a> <a id="13324" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">≢</a> <a id="13326" href="/Soundness/#13303" class="Bound">y</a>
    <a id="13332" class="Comment">-------------------</a>
  <a id="13354" class="Symbol">→</a> <a id="13356" href="/Soundness/#12829" class="Function">const-env</a> <a id="13366" href="/Soundness/#13301" class="Bound">x</a> <a id="13368" href="/Soundness/#13315" class="Bound">v</a> <a id="13370" href="/Soundness/#13303" class="Bound">y</a> <a id="13372" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="13374" href="/Denotational/#4120" class="InductiveConstructor">⊥</a>
<a id="13376" href="/Soundness/#13274" class="Function">diff-nth-const-env</a> <a id="13395" class="Symbol">{</a><a id="13396" href="/Soundness/#13396" class="Bound">Γ</a><a id="13397" class="Symbol">}</a> <a id="13399" class="Symbol">{</a><a id="13400" href="/Soundness/#13400" class="Bound">x</a><a id="13401" class="Symbol">}</a> <a id="13403" class="Symbol">{</a><a id="13404" href="/Soundness/#13404" class="Bound">y</a><a id="13405" class="Symbol">}</a> <a id="13407" href="/Soundness/#13407" class="Bound">neq</a> <a id="13411" class="Keyword">with</a> <a id="13416" href="/Soundness/#13400" class="Bound">x</a> <a id="13418" href="/Soundness/#12463" class="Function Operator">var≟</a> <a id="13423" href="/Soundness/#13404" class="Bound">y</a>
<a id="13425" class="Symbol">...</a>  <a id="13430" class="Symbol">|</a> <a id="13432" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="13436" href="/Soundness/#13436" class="Bound">eq</a>  <a id="13440" class="Symbol">=</a>  <a id="13443" href="https://agda.github.io/agda-stdlib/Data.Empty.html#360" class="Function">⊥-elim</a> <a id="13450" class="Symbol">(</a><a id="13451" class="Bound">neq</a> <a id="13455" href="/Soundness/#13436" class="Bound">eq</a><a id="13457" class="Symbol">)</a>
<a id="13459" class="Symbol">...</a>  <a id="13464" class="Symbol">|</a> <a id="13466" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="13469" class="Symbol">_</a>    <a id="13474" class="Symbol">=</a>  <a id="13477" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>So we choose <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code> and obtain <code class="highlighter-rouge">δ ⊢ x ↓ v</code>
with the <code class="highlighter-rouge">var</code> rule.</p>

<p>It remains to prove that <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code>, given that
we have chosen <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code>.  We shall have two cases to
consider, <code class="highlighter-rouge">x ≡ y</code> or <code class="highlighter-rouge">x ≢ y</code>.</p>

<p>Now to finish the two cases of the proof.</p>

<ul>
  <li>In the case where <code class="highlighter-rouge">x ≡ y</code>, we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ v</code>, but that’s just our premise.</li>
  <li>In the case where <code class="highlighter-rouge">x ≢ y,</code> we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ ⊥</code>, which we do via rule <code class="highlighter-rouge">⊥-intro</code>.</li>
</ul>

<p>Thus, we have completed the variable case of the proof that
simultaneous substitution reflects denotations.  Here is the proof
again, formally.</p>

<pre class="Agda"><a id="subst-reflect-var"></a><a id="14149" href="/Soundness/#14149" class="Function">subst-reflect-var</a> <a id="14167" class="Symbol">:</a> <a id="14169" class="Symbol">∀</a> <a id="14171" class="Symbol">{</a><a id="14172" href="/Soundness/#14172" class="Bound">Γ</a> <a id="14174" href="/Soundness/#14174" class="Bound">Δ</a><a id="14175" class="Symbol">}</a> <a id="14177" class="Symbol">{</a><a id="14178" href="/Soundness/#14178" class="Bound">γ</a> <a id="14180" class="Symbol">:</a> <a id="14182" href="/Denotational/#7334" class="Function">Env</a> <a id="14186" href="/Soundness/#14174" class="Bound">Δ</a><a id="14187" class="Symbol">}</a> <a id="14189" class="Symbol">{</a><a id="14190" href="/Soundness/#14190" class="Bound">x</a> <a id="14192" class="Symbol">:</a> <a id="14194" href="/Soundness/#14172" class="Bound">Γ</a> <a id="14196" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="14198" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="14199" class="Symbol">}</a> <a id="14201" class="Symbol">{</a><a id="14202" href="/Soundness/#14202" class="Bound">v</a><a id="14203" class="Symbol">}</a> <a id="14205" class="Symbol">{</a><a id="14206" href="/Soundness/#14206" class="Bound">σ</a> <a id="14208" class="Symbol">:</a> <a id="14210" href="/Soundness/#2673" class="Function">Subst</a> <a id="14216" href="/Soundness/#14172" class="Bound">Γ</a> <a id="14218" href="/Soundness/#14174" class="Bound">Δ</a><a id="14219" class="Symbol">}</a>
  <a id="14223" class="Symbol">→</a> <a id="14225" href="/Soundness/#14178" class="Bound">γ</a> <a id="14227" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="14229" href="/Soundness/#14206" class="Bound">σ</a> <a id="14231" href="/Soundness/#14190" class="Bound">x</a> <a id="14233" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="14235" href="/Soundness/#14202" class="Bound">v</a>
    <a id="14241" class="Comment">-----------------------------------------</a>
  <a id="14285" class="Symbol">→</a> <a id="14287" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="14290" href="/Soundness/#14290" class="Bound">δ</a> <a id="14292" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="14294" href="/Denotational/#7334" class="Function">Env</a> <a id="14298" href="/Soundness/#14172" class="Bound">Γ</a> <a id="14300" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="14302" href="/Soundness/#14178" class="Bound">γ</a> <a id="14304" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="14307" href="/Soundness/#14206" class="Bound">σ</a> <a id="14309" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="14311" href="/Soundness/#14290" class="Bound">δ</a>  <a id="14314" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="14317" href="/Soundness/#14290" class="Bound">δ</a> <a id="14319" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="14321" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="14323" href="/Soundness/#14190" class="Bound">x</a> <a id="14325" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="14327" href="/Soundness/#14202" class="Bound">v</a>
<a id="14329" href="/Soundness/#14149" class="Function">subst-reflect-var</a> <a id="14347" class="Symbol">{</a><a id="14348" href="/Soundness/#14348" class="Bound">Γ</a><a id="14349" class="Symbol">}{</a><a id="14351" href="/Soundness/#14351" class="Bound">Δ</a><a id="14352" class="Symbol">}{</a><a id="14354" href="/Soundness/#14354" class="Bound">γ</a><a id="14355" class="Symbol">}{</a><a id="14357" href="/Soundness/#14357" class="Bound">x</a><a id="14358" class="Symbol">}{</a><a id="14360" href="/Soundness/#14360" class="Bound">v</a><a id="14361" class="Symbol">}{</a><a id="14363" href="/Soundness/#14363" class="Bound">σ</a><a id="14364" class="Symbol">}</a> <a id="14366" href="/Soundness/#14366" class="Bound">xv</a>
  <a id="14371" class="Keyword">rewrite</a> <a id="14379" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="14383" class="Symbol">(</a><a id="14384" href="/Soundness/#13064" class="Function">nth-const-env</a> <a id="14398" class="Symbol">{</a><a id="14399" href="/Soundness/#14348" class="Bound">Γ</a><a id="14400" class="Symbol">}{</a><a id="14402" href="/Soundness/#14357" class="Bound">x</a><a id="14403" class="Symbol">}{</a><a id="14405" href="/Soundness/#14360" class="Bound">v</a><a id="14406" class="Symbol">})</a> <a id="14409" class="Symbol">=</a>
    <a id="14415" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14417" href="/Soundness/#12829" class="Function">const-env</a> <a id="14427" href="/Soundness/#14357" class="Bound">x</a> <a id="14429" href="/Soundness/#14360" class="Bound">v</a> <a id="14431" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14433" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14435" href="/Soundness/#14468" class="Function">const-env-ok</a> <a id="14448" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14450" href="/Denotational/#9674" class="InductiveConstructor">var</a> <a id="14454" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="14456" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
  <a id="14460" class="Keyword">where</a>
  <a id="14468" href="/Soundness/#14468" class="Function">const-env-ok</a> <a id="14481" class="Symbol">:</a> <a id="14483" href="/Soundness/#14354" class="Bound">γ</a> <a id="14485" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="14488" href="/Soundness/#14363" class="Bound">σ</a> <a id="14490" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="14492" href="/Soundness/#12829" class="Function">const-env</a> <a id="14502" href="/Soundness/#14357" class="Bound">x</a> <a id="14504" href="/Soundness/#14360" class="Bound">v</a>
  <a id="14508" href="/Soundness/#14468" class="Function">const-env-ok</a> <a id="14521" href="/Soundness/#14521" class="Bound">y</a> <a id="14523" class="Keyword">with</a> <a id="14528" href="/Soundness/#14357" class="Bound">x</a> <a id="14530" href="/Soundness/#12463" class="Function Operator">var≟</a> <a id="14535" href="/Soundness/#14521" class="Bound">y</a>
  <a id="14539" class="Symbol">...</a> <a id="14543" class="Symbol">|</a> <a id="14545" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="14549" href="/Soundness/#14549" class="Bound">x≡y</a> <a id="14553" class="Keyword">rewrite</a> <a id="14561" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="14565" href="/Soundness/#14549" class="Bound">x≡y</a> <a id="14569" class="Symbol">|</a> <a id="14571" href="/Soundness/#13064" class="Function">nth-const-env</a> <a id="14585" class="Symbol">{</a><a id="14586" href="/Soundness/#14348" class="Bound">Γ</a><a id="14587" class="Symbol">}{</a><a id="14589" href="/Soundness/#14357" class="Bound">x</a><a id="14590" class="Symbol">}{</a><a id="14592" href="/Soundness/#14360" class="Bound">v</a><a id="14593" class="Symbol">}</a> <a id="14595" class="Symbol">=</a> <a id="14597" href="/Soundness/#14366" class="Bound">xv</a>
  <a id="14602" class="Symbol">...</a> <a id="14606" class="Symbol">|</a> <a id="14608" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="14611" href="/Soundness/#14611" class="Bound">x≢y</a> <a id="14615" class="Keyword">rewrite</a> <a id="14623" href="/Soundness/#13274" class="Function">diff-nth-const-env</a> <a id="14642" class="Symbol">{</a><a id="14643" href="/Soundness/#14348" class="Bound">Γ</a><a id="14644" class="Symbol">}{</a><a id="14646" href="/Soundness/#14357" class="Bound">x</a><a id="14647" class="Symbol">}{</a><a id="14649" class="Bound">y</a><a id="14650" class="Symbol">}{</a><a id="14652" href="/Soundness/#14360" class="Bound">v</a><a id="14653" class="Symbol">}</a> <a id="14655" href="/Soundness/#14611" class="Bound">x≢y</a> <a id="14659" class="Symbol">=</a> <a id="14661" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a></pre>

<h3 id="substitutions-and-environment-construction">Substitutions and environment construction</h3>

<p>Every substitution produces terms that can evaluate to <code class="highlighter-rouge">⊥</code>.</p>

<pre class="Agda"><a id="subst-⊥"></a><a id="14804" href="/Soundness/#14804" class="Function">subst-⊥</a> <a id="14812" class="Symbol">:</a> <a id="14814" class="Symbol">∀{</a><a id="14816" href="/Soundness/#14816" class="Bound">Γ</a> <a id="14818" href="/Soundness/#14818" class="Bound">Δ</a><a id="14819" class="Symbol">}{</a><a id="14821" href="/Soundness/#14821" class="Bound">γ</a> <a id="14823" class="Symbol">:</a> <a id="14825" href="/Denotational/#7334" class="Function">Env</a> <a id="14829" href="/Soundness/#14818" class="Bound">Δ</a><a id="14830" class="Symbol">}{</a><a id="14832" href="/Soundness/#14832" class="Bound">σ</a> <a id="14834" class="Symbol">:</a> <a id="14836" href="/Soundness/#2673" class="Function">Subst</a> <a id="14842" href="/Soundness/#14816" class="Bound">Γ</a> <a id="14844" href="/Soundness/#14818" class="Bound">Δ</a><a id="14845" class="Symbol">}</a>
    <a id="14851" class="Comment">-----------------</a>
  <a id="14871" class="Symbol">→</a> <a id="14873" href="/Soundness/#14821" class="Bound">γ</a> <a id="14875" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="14878" href="/Soundness/#14832" class="Bound">σ</a> <a id="14880" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="14882" href="/Denotational/#8579" class="Function">`⊥</a>
<a id="14885" href="/Soundness/#14804" class="Function">subst-⊥</a> <a id="14893" href="/Soundness/#14893" class="Bound">x</a> <a id="14895" class="Symbol">=</a> <a id="14897" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a></pre>

<p>If a substitution produces terms that evaluate to the values in
both <code class="highlighter-rouge">γ₁</code> and <code class="highlighter-rouge">γ₂</code>, then those terms also evaluate to the values in 
<code class="highlighter-rouge">γ₁ ⊔ γ₂</code>.</p>

<pre class="Agda"><a id="subst-⊔"></a><a id="15075" href="/Soundness/#15075" class="Function">subst-⊔</a> <a id="15083" class="Symbol">:</a> <a id="15085" class="Symbol">∀{</a><a id="15087" href="/Soundness/#15087" class="Bound">Γ</a> <a id="15089" href="/Soundness/#15089" class="Bound">Δ</a><a id="15090" class="Symbol">}{</a><a id="15092" href="/Soundness/#15092" class="Bound">γ</a> <a id="15094" class="Symbol">:</a> <a id="15096" href="/Denotational/#7334" class="Function">Env</a> <a id="15100" href="/Soundness/#15089" class="Bound">Δ</a><a id="15101" class="Symbol">}{</a><a id="15103" href="/Soundness/#15103" class="Bound">γ₁</a> <a id="15106" href="/Soundness/#15106" class="Bound">γ₂</a> <a id="15109" class="Symbol">:</a> <a id="15111" href="/Denotational/#7334" class="Function">Env</a> <a id="15115" href="/Soundness/#15087" class="Bound">Γ</a><a id="15116" class="Symbol">}{</a><a id="15118" href="/Soundness/#15118" class="Bound">σ</a> <a id="15120" class="Symbol">:</a> <a id="15122" href="/Soundness/#2673" class="Function">Subst</a> <a id="15128" href="/Soundness/#15087" class="Bound">Γ</a> <a id="15130" href="/Soundness/#15089" class="Bound">Δ</a><a id="15131" class="Symbol">}</a>
           <a id="15144" class="Symbol">→</a> <a id="15146" href="/Soundness/#15092" class="Bound">γ</a> <a id="15148" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="15151" href="/Soundness/#15118" class="Bound">σ</a> <a id="15153" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="15155" href="/Soundness/#15103" class="Bound">γ₁</a>
           <a id="15169" class="Symbol">→</a> <a id="15171" href="/Soundness/#15092" class="Bound">γ</a> <a id="15173" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="15176" href="/Soundness/#15118" class="Bound">σ</a> <a id="15178" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="15180" href="/Soundness/#15106" class="Bound">γ₂</a>
             <a id="15196" class="Comment">-------------------------</a>
           <a id="15233" class="Symbol">→</a> <a id="15235" href="/Soundness/#15092" class="Bound">γ</a> <a id="15237" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="15240" href="/Soundness/#15118" class="Bound">σ</a> <a id="15242" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="15244" class="Symbol">(</a><a id="15245" href="/Soundness/#15103" class="Bound">γ₁</a> <a id="15248" href="/Denotational/#8608" class="Function Operator">`⊔</a> <a id="15251" href="/Soundness/#15106" class="Bound">γ₂</a><a id="15253" class="Symbol">)</a>
<a id="15255" href="/Soundness/#15075" class="Function">subst-⊔</a> <a id="15263" href="/Soundness/#15263" class="Bound">γ₁-ok</a> <a id="15269" href="/Soundness/#15269" class="Bound">γ₂-ok</a> <a id="15275" href="/Soundness/#15275" class="Bound">x</a> <a id="15277" class="Symbol">=</a> <a id="15279" href="/Denotational/#10090" class="InductiveConstructor">⊔-intro</a> <a id="15287" class="Symbol">(</a><a id="15288" href="/Soundness/#15263" class="Bound">γ₁-ok</a> <a id="15294" href="/Soundness/#15275" class="Bound">x</a><a id="15295" class="Symbol">)</a> <a id="15297" class="Symbol">(</a><a id="15298" href="/Soundness/#15269" class="Bound">γ₂-ok</a> <a id="15304" href="/Soundness/#15275" class="Bound">x</a><a id="15305" class="Symbol">)</a></pre>

<h3 id="the-lambda-constructor-is-injective">The Lambda constructor is injective</h3>

<pre class="Agda"><a id="lambda-inj"></a><a id="15373" href="/Soundness/#15373" class="Function">lambda-inj</a> <a id="15384" class="Symbol">:</a> <a id="15386" class="Symbol">∀</a> <a id="15388" class="Symbol">{</a><a id="15389" href="/Soundness/#15389" class="Bound">Γ</a><a id="15390" class="Symbol">}</a> <a id="15392" class="Symbol">{</a><a id="15393" href="/Soundness/#15393" class="Bound">M</a> <a id="15395" href="/Soundness/#15395" class="Bound">N</a> <a id="15397" class="Symbol">:</a> <a id="15399" href="/Soundness/#15389" class="Bound">Γ</a> <a id="15401" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15403" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15405" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15407" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15409" class="Symbol">}</a>
  <a id="15413" class="Symbol">→</a> <a id="15415" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a> <a id="15419" class="Symbol">{</a><a id="15420" class="Argument">A</a> <a id="15422" class="Symbol">=</a> <a id="15424" href="/Soundness/#15389" class="Bound">Γ</a> <a id="15426" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15428" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15429" class="Symbol">}</a> <a id="15431" class="Symbol">(</a><a id="15432" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15434" href="/Soundness/#15393" class="Bound">M</a><a id="15435" class="Symbol">)</a> <a id="15437" class="Symbol">(</a><a id="15438" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15440" href="/Soundness/#15395" class="Bound">N</a><a id="15441" class="Symbol">)</a>
    <a id="15447" class="Comment">---------------------------</a>
  <a id="15477" class="Symbol">→</a> <a id="15479" href="/Soundness/#15393" class="Bound">M</a> <a id="15481" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="15483" href="/Soundness/#15395" class="Bound">N</a>
<a id="15485" href="/Soundness/#15373" class="Function">lambda-inj</a> <a id="15496" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="15501" class="Symbol">=</a> <a id="15503" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<h3 id="simultaneous-substitution-reflects-denotations">Simultaneous substitution reflects denotations</h3>

<p>In this section we prove a central lemma, that
substitution reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>, then
<code class="highlighter-rouge">δ ⊢ M ↓ v</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> for some <code class="highlighter-rouge">δ</code>. We shall proceed by induction on
the derivation of <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>. This requires a minor
restatement of the lemma, changing the premise to <code class="highlighter-rouge">γ ⊢ L ↓ v</code> and
<code class="highlighter-rouge">L ≡ subst σ M</code>.</p>

<pre class="Agda"><a id="split"></a><a id="15925" href="/Soundness/#15925" class="Function">split</a> <a id="15931" class="Symbol">:</a> <a id="15933" class="Symbol">∀</a> <a id="15935" class="Symbol">{</a><a id="15936" href="/Soundness/#15936" class="Bound">Γ</a><a id="15937" class="Symbol">}</a> <a id="15939" class="Symbol">{</a><a id="15940" href="/Soundness/#15940" class="Bound">M</a> <a id="15942" class="Symbol">:</a> <a id="15944" href="/Soundness/#15936" class="Bound">Γ</a> <a id="15946" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15948" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15950" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15952" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15953" class="Symbol">}</a> <a id="15955" class="Symbol">{</a><a id="15956" href="/Soundness/#15956" class="Bound">δ</a> <a id="15958" class="Symbol">:</a> <a id="15960" href="/Denotational/#7334" class="Function">Env</a> <a id="15964" class="Symbol">(</a><a id="15965" href="/Soundness/#15936" class="Bound">Γ</a> <a id="15967" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15969" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15970" class="Symbol">)}</a> <a id="15973" class="Symbol">{</a><a id="15974" href="/Soundness/#15974" class="Bound">v</a><a id="15975" class="Symbol">}</a>
  <a id="15979" class="Symbol">→</a> <a id="15981" href="/Soundness/#15956" class="Bound">δ</a> <a id="15983" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="15985" href="/Soundness/#15940" class="Bound">M</a> <a id="15987" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="15989" href="/Soundness/#15974" class="Bound">v</a>
    <a id="15995" class="Comment">--------------------------</a>
  <a id="16024" class="Symbol">→</a> <a id="16026" class="Symbol">(</a><a id="16027" href="/Denotational/#7760" class="Function">init</a> <a id="16032" href="/Soundness/#15956" class="Bound">δ</a> <a id="16034" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="16037" href="/Denotational/#7815" class="Function">last</a> <a id="16042" href="/Soundness/#15956" class="Bound">δ</a><a id="16043" class="Symbol">)</a> <a id="16045" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="16047" href="/Soundness/#15940" class="Bound">M</a> <a id="16049" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="16051" href="/Soundness/#15974" class="Bound">v</a>
<a id="16053" href="/Soundness/#15925" class="Function">split</a> <a id="16059" class="Symbol">{</a><a id="16060" class="Argument">δ</a> <a id="16062" class="Symbol">=</a> <a id="16064" href="/Soundness/#16064" class="Bound">δ</a><a id="16065" class="Symbol">}</a> <a id="16067" href="/Soundness/#16067" class="Bound">δMv</a> <a id="16071" class="Keyword">rewrite</a> <a id="16079" href="/Denotational/#7864" class="Function">init-last</a> <a id="16089" href="/Soundness/#16064" class="Bound">δ</a> <a id="16091" class="Symbol">=</a> <a id="16093" href="/Soundness/#16067" class="Bound">δMv</a>

<a id="subst-reflect"></a><a id="16098" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="16112" class="Symbol">:</a> <a id="16114" class="Symbol">∀</a> <a id="16116" class="Symbol">{</a><a id="16117" href="/Soundness/#16117" class="Bound">Γ</a> <a id="16119" href="/Soundness/#16119" class="Bound">Δ</a><a id="16120" class="Symbol">}</a> <a id="16122" class="Symbol">{</a><a id="16123" href="/Soundness/#16123" class="Bound">δ</a> <a id="16125" class="Symbol">:</a> <a id="16127" href="/Denotational/#7334" class="Function">Env</a> <a id="16131" href="/Soundness/#16119" class="Bound">Δ</a><a id="16132" class="Symbol">}</a> <a id="16134" class="Symbol">{</a><a id="16135" href="/Soundness/#16135" class="Bound">M</a> <a id="16137" class="Symbol">:</a> <a id="16139" href="/Soundness/#16117" class="Bound">Γ</a> <a id="16141" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="16143" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="16144" class="Symbol">}</a> <a id="16146" class="Symbol">{</a><a id="16147" href="/Soundness/#16147" class="Bound">v</a><a id="16148" class="Symbol">}</a> <a id="16150" class="Symbol">{</a><a id="16151" href="/Soundness/#16151" class="Bound">L</a> <a id="16153" class="Symbol">:</a> <a id="16155" href="/Soundness/#16119" class="Bound">Δ</a> <a id="16157" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="16159" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="16160" class="Symbol">}</a> <a id="16162" class="Symbol">{</a><a id="16163" href="/Soundness/#16163" class="Bound">σ</a> <a id="16165" class="Symbol">:</a> <a id="16167" href="/Soundness/#2673" class="Function">Subst</a> <a id="16173" href="/Soundness/#16117" class="Bound">Γ</a> <a id="16175" href="/Soundness/#16119" class="Bound">Δ</a><a id="16176" class="Symbol">}</a>
  <a id="16180" class="Symbol">→</a> <a id="16182" href="/Soundness/#16123" class="Bound">δ</a> <a id="16184" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="16186" href="/Soundness/#16151" class="Bound">L</a> <a id="16188" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="16190" href="/Soundness/#16147" class="Bound">v</a>
  <a id="16194" class="Symbol">→</a> <a id="16196" href="/Untyped/#6931" class="Function">subst</a> <a id="16202" href="/Soundness/#16163" class="Bound">σ</a> <a id="16204" href="/Soundness/#16135" class="Bound">M</a> <a id="16206" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="16208" href="/Soundness/#16151" class="Bound">L</a>
    <a id="16214" class="Comment">---------------------------------------</a>
  <a id="16256" class="Symbol">→</a> <a id="16258" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="16261" href="/Soundness/#16261" class="Bound">γ</a> <a id="16263" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="16265" href="/Denotational/#7334" class="Function">Env</a> <a id="16269" href="/Soundness/#16117" class="Bound">Γ</a> <a id="16271" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="16273" href="/Soundness/#16123" class="Bound">δ</a> <a id="16275" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="16278" href="/Soundness/#16163" class="Bound">σ</a> <a id="16280" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="16282" href="/Soundness/#16261" class="Bound">γ</a>  <a id="16285" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="16288" href="/Soundness/#16261" class="Bound">γ</a> <a id="16290" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="16292" href="/Soundness/#16135" class="Bound">M</a> <a id="16294" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="16296" href="/Soundness/#16147" class="Bound">v</a>

<a id="16299" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="16313" class="Symbol">{</a><a id="16314" class="Argument">M</a> <a id="16316" class="Symbol">=</a> <a id="16318" href="/Soundness/#16318" class="Bound">M</a><a id="16319" class="Symbol">}{</a><a id="16321" class="Argument">σ</a> <a id="16323" class="Symbol">=</a> <a id="16325" href="/Soundness/#16325" class="Bound">σ</a><a id="16326" class="Symbol">}</a> <a id="16328" class="Symbol">(</a><a id="16329" href="/Denotational/#9674" class="InductiveConstructor">var</a> <a id="16333" class="Symbol">{</a><a id="16334" class="Argument">x</a> <a id="16336" class="Symbol">=</a> <a id="16338" href="/Soundness/#16338" class="Bound">y</a><a id="16339" class="Symbol">})</a> <a id="16342" href="/Soundness/#16342" class="Bound">eqL</a> <a id="16346" class="Keyword">with</a> <a id="16351" href="/Soundness/#16318" class="Bound">M</a> 
<a id="16354" class="Symbol">...</a> <a id="16358" class="Symbol">|</a> <a id="16360" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16362" href="/Soundness/#16362" class="Bound">x</a>  <a id="16365" class="Keyword">with</a> <a id="16370" href="/Denotational/#9674" class="InductiveConstructor">var</a> <a id="16374" class="Symbol">{</a><a id="16375" class="Argument">x</a> <a id="16377" class="Symbol">=</a> <a id="16379" class="Bound">y</a><a id="16380" class="Symbol">}</a>
<a id="16382" class="Symbol">...</a>           <a id="16396" class="Symbol">|</a> <a id="16398" href="/Soundness/#16398" class="Bound">yv</a>  <a id="16402" class="Keyword">rewrite</a> <a id="16410" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16414" class="Bound">eqL</a> <a id="16418" class="Symbol">=</a> <a id="16420" href="/Soundness/#14149" class="Function">subst-reflect-var</a> <a id="16438" class="Symbol">{</a><a id="16439" class="Argument">σ</a> <a id="16441" class="Symbol">=</a> <a id="16443" class="Bound">σ</a><a id="16444" class="Symbol">}</a> <a id="16446" href="/Soundness/#16398" class="Bound">yv</a>
<a id="16449" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="16463" class="Symbol">{</a><a id="16464" class="Argument">M</a> <a id="16466" class="Symbol">=</a> <a id="16468" href="/Soundness/#16468" class="Bound">M</a><a id="16469" class="Symbol">}</a> <a id="16471" class="Symbol">(</a><a id="16472" href="/Denotational/#9674" class="InductiveConstructor">var</a> <a id="16476" class="Symbol">{</a><a id="16477" class="Argument">x</a> <a id="16479" class="Symbol">=</a> <a id="16481" href="/Soundness/#16481" class="Bound">y</a><a id="16482" class="Symbol">})</a> <a id="16485" class="Symbol">()</a> <a id="16488" class="Symbol">|</a> <a id="16490" href="/Soundness/#16490" class="Bound">M₁</a> <a id="16493" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16495" href="/Soundness/#16495" class="Bound">M₂</a>
<a id="16498" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="16512" class="Symbol">{</a><a id="16513" class="Argument">M</a> <a id="16515" class="Symbol">=</a> <a id="16517" href="/Soundness/#16517" class="Bound">M</a><a id="16518" class="Symbol">}</a> <a id="16520" class="Symbol">(</a><a id="16521" href="/Denotational/#9674" class="InductiveConstructor">var</a> <a id="16525" class="Symbol">{</a><a id="16526" class="Argument">x</a> <a id="16528" class="Symbol">=</a> <a id="16530" href="/Soundness/#16530" class="Bound">y</a><a id="16531" class="Symbol">})</a> <a id="16534" class="Symbol">()</a> <a id="16537" class="Symbol">|</a> <a id="16539" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16541" href="/Soundness/#16541" class="Bound">M′</a>

<a id="16545" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="16559" class="Symbol">{</a><a id="16560" class="Argument">M</a> <a id="16562" class="Symbol">=</a> <a id="16564" href="/Soundness/#16564" class="Bound">M</a><a id="16565" class="Symbol">}{</a><a id="16567" class="Argument">σ</a> <a id="16569" class="Symbol">=</a> <a id="16571" href="/Soundness/#16571" class="Bound">σ</a><a id="16572" class="Symbol">}</a> <a id="16574" class="Symbol">(</a><a id="16575" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="16582" href="/Soundness/#16582" class="Bound">d₁</a> <a id="16585" href="/Soundness/#16585" class="Bound">d₂</a><a id="16587" class="Symbol">)</a> <a id="16589" href="/Soundness/#16589" class="Bound">eqL</a>
         <a id="16602" class="Keyword">with</a> <a id="16607" href="/Soundness/#16564" class="Bound">M</a> 
<a id="16610" class="Symbol">...</a>    <a id="16617" class="Symbol">|</a> <a id="16619" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16621" href="/Soundness/#16621" class="Bound">x</a> <a id="16623" class="Keyword">with</a> <a id="16628" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="16635" class="Bound">d₁</a> <a id="16638" class="Bound">d₂</a> 
<a id="16642" class="Symbol">...</a>    <a id="16649" class="Symbol">|</a> <a id="16651" href="/Soundness/#16651" class="Bound">d′</a> <a id="16654" class="Keyword">rewrite</a> <a id="16662" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16666" class="Bound">eqL</a> <a id="16670" class="Symbol">=</a> <a id="16672" href="/Soundness/#14149" class="Function">subst-reflect-var</a> <a id="16690" class="Symbol">{</a><a id="16691" class="Argument">σ</a> <a id="16693" class="Symbol">=</a> <a id="16695" class="Bound">σ</a><a id="16696" class="Symbol">}</a> <a id="16698" href="/Soundness/#16651" class="Bound">d′</a>
<a id="16701" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="16715" class="Symbol">(</a><a id="16716" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="16723" href="/Soundness/#16723" class="Bound">d₁</a> <a id="16726" href="/Soundness/#16726" class="Bound">d₂</a><a id="16728" class="Symbol">)</a> <a id="16730" class="Symbol">()</a> <a id="16733" class="Symbol">|</a> <a id="16735" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16737" href="/Soundness/#16737" class="Bound">M′</a>
<a id="16740" href="/Soundness/#16098" class="Function">subst-reflect</a><a id="16753" class="Symbol">{</a><a id="16754" href="/Soundness/#16754" class="Bound">Γ</a><a id="16755" class="Symbol">}{</a><a id="16757" href="/Soundness/#16757" class="Bound">Δ</a><a id="16758" class="Symbol">}{</a><a id="16760" href="/Soundness/#16760" class="Bound">γ</a><a id="16761" class="Symbol">}{</a><a id="16763" class="Argument">σ</a> <a id="16765" class="Symbol">=</a> <a id="16767" href="/Soundness/#16767" class="Bound">σ</a><a id="16768" class="Symbol">}</a> <a id="16770" class="Symbol">(</a><a id="16771" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="16778" href="/Soundness/#16778" class="Bound">d₁</a> <a id="16781" href="/Soundness/#16781" class="Bound">d₂</a><a id="16783" class="Symbol">)</a>
   <a id="16788" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16793" class="Symbol">|</a> <a id="16795" href="/Soundness/#16795" class="Bound">M₁</a> <a id="16798" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16800" href="/Soundness/#16800" class="Bound">M₂</a>
     <a id="16808" class="Keyword">with</a> <a id="16813" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="16827" class="Symbol">{</a><a id="16828" class="Argument">M</a> <a id="16830" class="Symbol">=</a> <a id="16832" href="/Soundness/#16795" class="Bound">M₁</a><a id="16834" class="Symbol">}</a> <a id="16836" href="/Soundness/#16778" class="Bound">d₁</a> <a id="16839" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16844" class="Symbol">|</a> <a id="16846" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="16860" class="Symbol">{</a><a id="16861" class="Argument">M</a> <a id="16863" class="Symbol">=</a> <a id="16865" href="/Soundness/#16800" class="Bound">M₂</a><a id="16867" class="Symbol">}</a> <a id="16869" href="/Soundness/#16781" class="Bound">d₂</a> <a id="16872" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="16877" class="Symbol">...</a>     <a id="16885" class="Symbol">|</a> <a id="16887" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16889" href="/Soundness/#16889" class="Bound">δ₁</a> <a id="16892" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16894" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16896" href="/Soundness/#16896" class="Bound">subst-δ₁</a> <a id="16905" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16907" href="/Soundness/#16907" class="Bound">m1</a> <a id="16910" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16912" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16914" class="Symbol">|</a> <a id="16916" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16918" href="/Soundness/#16918" class="Bound">δ₂</a> <a id="16921" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16923" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16925" href="/Soundness/#16925" class="Bound">subst-δ₂</a> <a id="16934" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16936" href="/Soundness/#16936" class="Bound">m2</a> <a id="16939" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16941" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16943" class="Symbol">=</a>
     <a id="16950" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16952" href="/Soundness/#16889" class="Bound">δ₁</a> <a id="16955" href="/Denotational/#8608" class="Function Operator">`⊔</a> <a id="16958" href="/Soundness/#16918" class="Bound">δ₂</a> <a id="16961" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16963" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16965" href="/Soundness/#15075" class="Function">subst-⊔</a> <a id="16973" class="Symbol">{</a><a id="16974" class="Argument">γ₁</a> <a id="16977" class="Symbol">=</a> <a id="16979" href="/Soundness/#16889" class="Bound">δ₁</a><a id="16981" class="Symbol">}{</a><a id="16983" class="Argument">γ₂</a> <a id="16986" class="Symbol">=</a> <a id="16988" href="/Soundness/#16918" class="Bound">δ₂</a><a id="16990" class="Symbol">}{</a><a id="16992" class="Argument">σ</a> <a id="16994" class="Symbol">=</a> <a id="16996" class="Bound">σ</a><a id="16997" class="Symbol">}</a> <a id="16999" href="/Soundness/#16896" class="Bound">subst-δ₁</a> <a id="17008" href="/Soundness/#16925" class="Bound">subst-δ₂</a> <a id="17017" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="17039" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="17046" class="Symbol">(</a><a id="17047" href="/Denotational/#26680" class="Function">Env⊑</a> <a id="17052" href="/Soundness/#16907" class="Bound">m1</a> <a id="17055" class="Symbol">(</a><a id="17056" href="/Denotational/#8946" class="Function">EnvConjR1⊑</a> <a id="17067" href="/Soundness/#16889" class="Bound">δ₁</a> <a id="17070" href="/Soundness/#16918" class="Bound">δ₂</a><a id="17072" class="Symbol">))</a>
                           <a id="17102" class="Symbol">(</a><a id="17103" href="/Denotational/#26680" class="Function">Env⊑</a> <a id="17108" href="/Soundness/#16936" class="Bound">m2</a> <a id="17111" class="Symbol">(</a><a id="17112" href="/Denotational/#9043" class="Function">EnvConjR2⊑</a> <a id="17123" href="/Soundness/#16889" class="Bound">δ₁</a> <a id="17126" href="/Soundness/#16918" class="Bound">δ₂</a><a id="17128" class="Symbol">))</a> <a id="17131" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17133" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="17136" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="17150" class="Symbol">{</a><a id="17151" class="Argument">M</a> <a id="17153" class="Symbol">=</a> <a id="17155" href="/Soundness/#17155" class="Bound">M</a><a id="17156" class="Symbol">}{</a><a id="17158" class="Argument">σ</a> <a id="17160" class="Symbol">=</a> <a id="17162" href="/Soundness/#17162" class="Bound">σ</a><a id="17163" class="Symbol">}</a> <a id="17165" class="Symbol">(</a><a id="17166" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="17174" href="/Soundness/#17174" class="Bound">d</a><a id="17175" class="Symbol">)</a> <a id="17177" href="/Soundness/#17177" class="Bound">eqL</a> <a id="17181" class="Keyword">with</a> <a id="17186" href="/Soundness/#17155" class="Bound">M</a>
<a id="17188" class="Symbol">...</a>    <a id="17195" class="Symbol">|</a> <a id="17197" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="17199" href="/Soundness/#17199" class="Bound">x</a> <a id="17201" class="Keyword">with</a> <a id="17206" class="Symbol">(</a><a id="17207" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="17215" class="Bound">d</a><a id="17216" class="Symbol">)</a>
<a id="17218" class="Symbol">...</a>             <a id="17234" class="Symbol">|</a> <a id="17236" href="/Soundness/#17236" class="Bound">d′</a> <a id="17239" class="Keyword">rewrite</a> <a id="17247" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="17251" class="Bound">eqL</a> <a id="17255" class="Symbol">=</a> <a id="17257" href="/Soundness/#14149" class="Function">subst-reflect-var</a> <a id="17275" class="Symbol">{</a><a id="17276" class="Argument">σ</a> <a id="17278" class="Symbol">=</a> <a id="17280" class="Bound">σ</a><a id="17281" class="Symbol">}</a> <a id="17283" href="/Soundness/#17236" class="Bound">d′</a>
<a id="17286" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="17300" class="Symbol">{</a><a id="17301" class="Argument">σ</a> <a id="17303" class="Symbol">=</a> <a id="17305" href="/Soundness/#17305" class="Bound">σ</a><a id="17306" class="Symbol">}</a> <a id="17308" class="Symbol">(</a><a id="17309" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="17317" href="/Soundness/#17317" class="Bound">d</a><a id="17318" class="Symbol">)</a> <a id="17320" href="/Soundness/#17320" class="Bound">eq</a> <a id="17323" class="Symbol">|</a> <a id="17325" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="17327" href="/Soundness/#17327" class="Bound">M′</a>
      <a id="17336" class="Keyword">with</a> <a id="17341" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="17355" class="Symbol">{</a><a id="17356" class="Argument">σ</a> <a id="17358" class="Symbol">=</a> <a id="17360" href="/Untyped/#6623" class="Function">exts</a> <a id="17365" href="/Soundness/#17305" class="Bound">σ</a><a id="17366" class="Symbol">}</a> <a id="17368" href="/Soundness/#17317" class="Bound">d</a> <a id="17370" class="Symbol">(</a><a id="17371" href="/Soundness/#15373" class="Function">lambda-inj</a> <a id="17382" href="/Soundness/#17320" class="Bound">eq</a><a id="17384" class="Symbol">)</a>
<a id="17386" class="Symbol">...</a> <a id="17390" class="Symbol">|</a> <a id="17392" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17394" href="/Soundness/#17394" class="Bound">δ′</a> <a id="17397" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17399" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17401" href="/Soundness/#17401" class="Bound">exts-σ-δ′</a> <a id="17411" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17413" href="/Soundness/#17413" class="Bound">m′</a> <a id="17416" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17418" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17420" class="Symbol">=</a> 
    <a id="17427" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17429" href="/Denotational/#7760" class="Function">init</a> <a id="17434" href="/Soundness/#17394" class="Bound">δ′</a> <a id="17437" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17439" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17441" class="Symbol">((λ</a> <a id="17445" href="/Soundness/#17445" class="Bound">x</a> <a id="17447" class="Symbol">→</a> <a id="17449" href="/Soundness/#11287" class="Function">rename-inc-reflect</a> <a id="17468" class="Symbol">(</a><a id="17469" href="/Soundness/#17401" class="Bound">exts-σ-δ′</a> <a id="17479" class="Symbol">(</a><a id="17480" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="17482" href="/Soundness/#17445" class="Bound">x</a><a id="17483" class="Symbol">))))</a> <a id="17488" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
             <a id="17503" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="17511" class="Symbol">(</a><a id="17512" href="/Denotational/#27114" class="Function">up-env</a> <a id="17519" class="Symbol">(</a><a id="17520" href="/Soundness/#15925" class="Function">split</a> <a id="17526" href="/Soundness/#17413" class="Bound">m′</a><a id="17528" class="Symbol">)</a> <a id="17530" class="Symbol">(</a><a id="17531" href="/Compositional/#9007" class="Function">var-inv</a> <a id="17539" class="Symbol">(</a><a id="17540" href="/Soundness/#17401" class="Bound">exts-σ-δ′</a> <a id="17550" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="17551" class="Symbol">)))</a> <a id="17555" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17557" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="17559" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="17573" class="Symbol">(</a><a id="17574" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="17582" href="/Soundness/#17582" class="Bound">d</a><a id="17583" class="Symbol">)</a> <a id="17585" class="Symbol">()</a> <a id="17588" class="Symbol">|</a> <a id="17590" href="/Soundness/#17590" class="Bound">M₁</a> <a id="17593" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="17595" href="/Soundness/#17595" class="Bound">M₂</a> 

<a id="17600" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="17614" class="Symbol">{</a><a id="17615" class="Argument">σ</a> <a id="17617" class="Symbol">=</a> <a id="17619" href="/Soundness/#17619" class="Bound">σ</a><a id="17620" class="Symbol">}</a> <a id="17622" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a> <a id="17630" href="/Soundness/#17630" class="Bound">eq</a> <a id="17633" class="Symbol">=</a>
    <a id="17639" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17641" href="/Denotational/#8579" class="Function">`⊥</a> <a id="17644" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17646" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17648" href="/Soundness/#14804" class="Function">subst-⊥</a> <a id="17656" class="Symbol">{</a><a id="17657" class="Argument">σ</a> <a id="17659" class="Symbol">=</a> <a id="17661" href="/Soundness/#17619" class="Bound">σ</a><a id="17662" class="Symbol">}</a> <a id="17664" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17666" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a> <a id="17674" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17676" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="17679" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="17693" class="Symbol">{</a><a id="17694" class="Argument">σ</a> <a id="17696" class="Symbol">=</a> <a id="17698" href="/Soundness/#17698" class="Bound">σ</a><a id="17699" class="Symbol">}</a> <a id="17701" class="Symbol">(</a><a id="17702" href="/Denotational/#10090" class="InductiveConstructor">⊔-intro</a> <a id="17710" href="/Soundness/#17710" class="Bound">d₁</a> <a id="17713" href="/Soundness/#17713" class="Bound">d₂</a><a id="17715" class="Symbol">)</a> <a id="17717" href="/Soundness/#17717" class="Bound">eq</a>
  <a id="17722" class="Keyword">with</a> <a id="17727" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="17741" class="Symbol">{</a><a id="17742" class="Argument">σ</a> <a id="17744" class="Symbol">=</a> <a id="17746" href="/Soundness/#17698" class="Bound">σ</a><a id="17747" class="Symbol">}</a> <a id="17749" href="/Soundness/#17710" class="Bound">d₁</a> <a id="17752" href="/Soundness/#17717" class="Bound">eq</a> <a id="17755" class="Symbol">|</a> <a id="17757" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="17771" class="Symbol">{</a><a id="17772" class="Argument">σ</a> <a id="17774" class="Symbol">=</a> <a id="17776" href="/Soundness/#17698" class="Bound">σ</a><a id="17777" class="Symbol">}</a> <a id="17779" href="/Soundness/#17713" class="Bound">d₂</a> <a id="17782" href="/Soundness/#17717" class="Bound">eq</a>
<a id="17785" class="Symbol">...</a> <a id="17789" class="Symbol">|</a> <a id="17791" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17793" href="/Soundness/#17793" class="Bound">δ₁</a> <a id="17796" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17798" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17800" href="/Soundness/#17800" class="Bound">subst-δ₁</a> <a id="17809" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17811" href="/Soundness/#17811" class="Bound">m1</a> <a id="17814" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17816" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17818" class="Symbol">|</a> <a id="17820" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17822" href="/Soundness/#17822" class="Bound">δ₂</a> <a id="17825" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17827" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17829" href="/Soundness/#17829" class="Bound">subst-δ₂</a> <a id="17838" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17840" href="/Soundness/#17840" class="Bound">m2</a> <a id="17843" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17845" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17847" class="Symbol">=</a>
     <a id="17854" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17856" href="/Soundness/#17793" class="Bound">δ₁</a> <a id="17859" href="/Denotational/#8608" class="Function Operator">`⊔</a> <a id="17862" href="/Soundness/#17822" class="Bound">δ₂</a> <a id="17865" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17867" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17869" href="/Soundness/#15075" class="Function">subst-⊔</a> <a id="17877" class="Symbol">{</a><a id="17878" class="Argument">γ₁</a> <a id="17881" class="Symbol">=</a> <a id="17883" href="/Soundness/#17793" class="Bound">δ₁</a><a id="17885" class="Symbol">}{</a><a id="17887" class="Argument">γ₂</a> <a id="17890" class="Symbol">=</a> <a id="17892" href="/Soundness/#17822" class="Bound">δ₂</a><a id="17894" class="Symbol">}{</a><a id="17896" class="Argument">σ</a> <a id="17898" class="Symbol">=</a> <a id="17900" class="Bound">σ</a><a id="17901" class="Symbol">}</a> <a id="17903" href="/Soundness/#17800" class="Bound">subst-δ₁</a> <a id="17912" href="/Soundness/#17829" class="Bound">subst-δ₂</a> <a id="17921" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="17943" href="/Denotational/#10090" class="InductiveConstructor">⊔-intro</a> <a id="17951" class="Symbol">(</a><a id="17952" href="/Denotational/#26680" class="Function">Env⊑</a> <a id="17957" href="/Soundness/#17811" class="Bound">m1</a> <a id="17960" class="Symbol">(</a><a id="17961" href="/Denotational/#8946" class="Function">EnvConjR1⊑</a> <a id="17972" href="/Soundness/#17793" class="Bound">δ₁</a> <a id="17975" href="/Soundness/#17822" class="Bound">δ₂</a><a id="17977" class="Symbol">))</a>
                            <a id="18008" class="Symbol">(</a><a id="18009" href="/Denotational/#26680" class="Function">Env⊑</a> <a id="18014" href="/Soundness/#17840" class="Bound">m2</a> <a id="18017" class="Symbol">(</a><a id="18018" href="/Denotational/#9043" class="Function">EnvConjR2⊑</a> <a id="18029" href="/Soundness/#17793" class="Bound">δ₁</a> <a id="18032" href="/Soundness/#17822" class="Bound">δ₂</a><a id="18034" class="Symbol">))</a> <a id="18037" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="18039" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="18041" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="18055" class="Symbol">(</a><a id="18056" href="/Denotational/#10226" class="InductiveConstructor">sub</a> <a id="18060" href="/Soundness/#18060" class="Bound">d</a> <a id="18062" href="/Soundness/#18062" class="Bound">lt</a><a id="18064" class="Symbol">)</a> <a id="18066" href="/Soundness/#18066" class="Bound">eq</a> 
    <a id="18074" class="Keyword">with</a> <a id="18079" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="18093" href="/Soundness/#18060" class="Bound">d</a> <a id="18095" href="/Soundness/#18066" class="Bound">eq</a>
<a id="18098" class="Symbol">...</a> <a id="18102" class="Symbol">|</a> <a id="18104" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="18106" href="/Soundness/#18106" class="Bound">δ</a> <a id="18108" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="18110" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="18112" href="/Soundness/#18112" class="Bound">subst-δ</a> <a id="18120" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="18122" href="/Soundness/#18122" class="Bound">m</a> <a id="18124" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="18126" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="18128" class="Symbol">=</a> <a id="18130" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="18132" href="/Soundness/#18106" class="Bound">δ</a> <a id="18134" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="18136" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="18138" href="/Soundness/#18112" class="Bound">subst-δ</a> <a id="18146" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="18148" href="/Denotational/#10226" class="InductiveConstructor">sub</a> <a id="18152" href="/Soundness/#18122" class="Bound">m</a> <a id="18154" class="Bound">lt</a> <a id="18157" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="18159" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<ul>
  <li>
    <p>Case <code class="highlighter-rouge">var</code>: We have subst <code class="highlighter-rouge">σ M ≡ y</code>, so <code class="highlighter-rouge">M</code> must also be a variable, say <code class="highlighter-rouge">x</code>.
We apply the lemma <code class="highlighter-rouge">subst-reflect-var</code> to conclude.</p>
  </li>
  <li>Case <code class="highlighter-rouge">↦-elim</code>: We have <code class="highlighter-rouge">subst σ M ≡ L₁ · L₂</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma again to conclude.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ M₁ · M₂</code>: By the induction hypothesis, we have
some <code class="highlighter-rouge">δ₁</code> and <code class="highlighter-rouge">δ₂</code> such that <code class="highlighter-rouge">δ₁ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁</code>,
as well as <code class="highlighter-rouge">δ₂ ⊢ M₂ ↓ v₁</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₂</code>.
By <code class="highlighter-rouge">Env⊑</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₂ ↓ v₁</code>
(using <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>), and therefore
<code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ · M₂ ↓ v₃</code>.
We conclude this case by obtaining <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁ ⊔ δ₂</code>
by the <code class="highlighter-rouge">subst-⊔</code> lemma.</p>
      </li>
    </ul>
  </li>
  <li>Case <code class="highlighter-rouge">↦-intro</code>: We have <code class="highlighter-rouge">subst σ M ≡ ƛ L′</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ ƛ M′</code>: By the induction hypothesis, we have
<code class="highlighter-rouge">(δ′ , v′) ⊢ M′ ↓ v₂</code> and <code class="highlighter-rouge">(δ , v₁) ⊢ exts σ ↓ (δ′ , v′)</code>.
From the later we have <code class="highlighter-rouge">(δ , v₁) ⊢ # 0 ↓ v′</code>.
By the lemma <code class="highlighter-rouge">var-inv</code> we have <code class="highlighter-rouge">v′ ⊑ v₁</code>, so by the <code class="highlighter-rouge">up-env</code> lemma we
have <code class="highlighter-rouge">(δ′ , v₁) ⊢ M′ ↓ v₂</code> and therefore <code class="highlighter-rouge">δ′ ⊢ ƛ M′ ↓ v₁ → v₂</code>.  We
also need to show that <code class="highlighter-rouge">δ </code>⊢ σ ↓ δ′<code class="highlighter-rouge">.  Fix </code>k<code class="highlighter-rouge">. We have
</code>(δ , v₁) ⊢ rename S_ σ k ↓ nth k δ′<code class="highlighter-rouge">.  We then apply the lemma
</code>rename-inc-reflect<code class="highlighter-rouge"> to obtain </code>δ ⊢ σ k ↓ nth k δ′`, so this case is
complete.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Case <code class="highlighter-rouge">⊥-intro</code>: We choose <code class="highlighter-rouge">⊥</code> for <code class="highlighter-rouge">δ</code>.
We have <code class="highlighter-rouge">⊥ ⊢ M ↓ ⊥</code> by <code class="highlighter-rouge">⊥-intro</code>.
We have <code class="highlighter-rouge">δ ⊢ σ ↓ ⊥</code> by the lemma <code class="highlighter-rouge">subst-empty</code>.</p>
  </li>
  <li>Case <code class="highlighter-rouge">⊔-intro</code>: By the induction hypothesis we have
<code class="highlighter-rouge">δ₁ ⊢ M ↓ v₁</code>, <code class="highlighter-rouge">δ₂ ⊢ M ↓ v₂</code>, <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁</code>, and <code class="highlighter-rouge">δ ⊢ σ ↓ δ₂</code>.
We have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₂</code>
by <code class="highlighter-rouge">Env⊑</code> with <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>.
So by <code class="highlighter-rouge">⊔-intro</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁ ⊔ v₂</code>.
By <code class="highlighter-rouge">subst-⊔</code> we conclude that <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁ ⊔ δ₂</code>.</li>
</ul>

<h3 id="single-substitution-reflects-denotations">Single substitution reflects denotations</h3>

<p>Most of the work is now behind us. We have proved that simultaneous
substitution reflects denotations. Of course, β reduction uses single
substitution, so we need a corollary that proves that single
substitution reflects denotations. That is,
give terms <code class="highlighter-rouge">N : (Γ , ★ ⊢ ★)</code> and <code class="highlighter-rouge">M : (Γ ⊢ ★)</code>,
if <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ w</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code> and <code class="highlighter-rouge">(γ , v) ⊢ N ↓ w</code>
for some value <code class="highlighter-rouge">v</code>. We have <code class="highlighter-rouge">N [ M ] = subst (subst-zero M) N</code>.
We apply the <code class="highlighter-rouge">subst-reflect</code> lemma to obtain
<code class="highlighter-rouge">γ ⊢ subst-zero M ↓ (δ′ , v′)</code> and <code class="highlighter-rouge">(δ′ , v′) ⊢ N ↓ w</code>
for some <code class="highlighter-rouge">δ′</code> and <code class="highlighter-rouge">v′</code>.</p>

<p>Instantiating <code class="highlighter-rouge">γ ⊢ subst-zero M ↓ (δ′ , v′)</code> at <code class="highlighter-rouge">k = 0</code>
gives us <code class="highlighter-rouge">γ ⊢ M ↓ v′</code>. We choose <code class="highlighter-rouge">w = v′</code>, so the first
part of our conclusion is complete.</p>

<p>It remains to prove <code class="highlighter-rouge">(γ , v′) ⊢ N ↓ v</code>. First, we obtain 
<code class="highlighter-rouge">(γ , v′) ⊢ rename var-id N ↓ v</code> by the <code class="highlighter-rouge">rename-pres</code> lemma
applied to <code class="highlighter-rouge">(δ′ , v′) ⊢ N ↓ v</code>, with the <code class="highlighter-rouge">var-id</code> renaming,
<code class="highlighter-rouge">γ = (δ′ , v′)</code>, and <code class="highlighter-rouge">δ = (γ , v′)</code>. To apply this lemma,
we need to show that 
<code class="highlighter-rouge">nth n (δ′ , v′) ⊑ nth (var-id n) (γ , v′)</code> for any <code class="highlighter-rouge">n</code>.
This is accomplished by the following lemma, which
makes use of <code class="highlighter-rouge">γ ⊢ subst-zero M ↓ (δ′ , v′)</code>.</p>

<pre class="Agda"><a id="nth-id-le"></a><a id="21165" href="/Soundness/#21165" class="Function">nth-id-le</a> <a id="21175" class="Symbol">:</a> <a id="21177" class="Symbol">∀{</a><a id="21179" href="/Soundness/#21179" class="Bound">Γ</a><a id="21180" class="Symbol">}{</a><a id="21182" href="/Soundness/#21182" class="Bound">δ′</a><a id="21184" class="Symbol">}{</a><a id="21186" href="/Soundness/#21186" class="Bound">v′</a><a id="21188" class="Symbol">}{</a><a id="21190" href="/Soundness/#21190" class="Bound">γ</a><a id="21191" class="Symbol">}{</a><a id="21193" href="/Soundness/#21193" class="Bound">M</a><a id="21194" class="Symbol">}</a>
      <a id="21202" class="Symbol">→</a> <a id="21204" href="/Soundness/#21190" class="Bound">γ</a> <a id="21206" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="21209" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="21220" href="/Soundness/#21193" class="Bound">M</a> <a id="21222" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="21224" class="Symbol">(</a><a id="21225" href="/Soundness/#21182" class="Bound">δ′</a> <a id="21228" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="21231" href="/Soundness/#21186" class="Bound">v′</a><a id="21233" class="Symbol">)</a>
        <a id="21243" class="Comment">-----------------------------------------------------</a>
      <a id="21303" class="Symbol">→</a> <a id="21305" class="Symbol">(</a><a id="21306" href="/Soundness/#21306" class="Bound">x</a> <a id="21308" class="Symbol">:</a> <a id="21310" href="/Soundness/#21179" class="Bound">Γ</a> <a id="21312" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="21314" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="21316" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="21318" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21319" class="Symbol">)</a> <a id="21321" class="Symbol">→</a> <a id="21323" class="Symbol">(</a><a id="21324" href="/Soundness/#21182" class="Bound">δ′</a> <a id="21327" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="21330" href="/Soundness/#21186" class="Bound">v′</a><a id="21332" class="Symbol">)</a> <a id="21334" href="/Soundness/#21306" class="Bound">x</a> <a id="21336" href="/Denotational/#4471" class="Datatype Operator">⊑</a> <a id="21338" class="Symbol">(</a><a id="21339" href="/Soundness/#21190" class="Bound">γ</a> <a id="21341" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="21344" href="/Soundness/#21186" class="Bound">v′</a><a id="21346" class="Symbol">)</a> <a id="21348" class="Symbol">(</a><a id="21349" href="/Denotational/#26332" class="Function">var-id</a> <a id="21356" href="/Soundness/#21306" class="Bound">x</a><a id="21357" class="Symbol">)</a> 
<a id="21360" href="/Soundness/#21165" class="Function">nth-id-le</a> <a id="21370" href="/Soundness/#21370" class="Bound">γ-sz-δ′v′</a> <a id="21380" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="21382" class="Symbol">=</a> <a id="21384" href="/Denotational/#5641" class="Function">Refl⊑</a>
<a id="21390" href="/Soundness/#21165" class="Function">nth-id-le</a> <a id="21400" href="/Soundness/#21400" class="Bound">γ-sz-δ′v′</a> <a id="21410" class="Symbol">(</a><a id="21411" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="21413" href="/Soundness/#21413" class="Bound">n′</a><a id="21415" class="Symbol">)</a> <a id="21417" class="Symbol">=</a> <a id="21419" href="/Compositional/#9007" class="Function">var-inv</a> <a id="21427" class="Symbol">(</a><a id="21428" href="/Soundness/#21400" class="Bound">γ-sz-δ′v′</a> <a id="21438" class="Symbol">(</a><a id="21439" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="21441" href="/Soundness/#21413" class="Bound">n′</a><a id="21443" class="Symbol">))</a></pre>

<p>The above lemma proceeds by induction on <code class="highlighter-rouge">n</code>.</p>

<ul>
  <li>If it is <code class="highlighter-rouge">Z</code>, then we show that <code class="highlighter-rouge">v′ ⊑ v′</code> by <code class="highlighter-rouge">Refl⊑</code>.</li>
  <li>If it is <code class="highlighter-rouge">S n′</code>, then from the premise we obtain
<code class="highlighter-rouge">γ ⊢ # n′ ↓ nth n′ δ′</code>. By <code class="highlighter-rouge">var-inv</code> we have
<code class="highlighter-rouge">nth n′ δ′ ⊑ nth n′ γ</code> from which we conclude that
<code class="highlighter-rouge">nth (S n′) (δ′ , v′) ⊑ nth (var-id (S n′)) (γ , v′)</code>.</li>
</ul>

<p>Returning to the proof that single substitution reflects
denotations, we have just proved that</p>

<p>(γ `, v′) ⊢ rename var-id N ↓ v</p>

<p>but we need to show <code class="highlighter-rouge">(γ </code>, v′) ⊢ N ↓ v<code class="highlighter-rouge">.
So we apply the </code>rename-id<code class="highlighter-rouge"> lemma to obtain
</code>rename var-id N ≡ N`.</p>

<p>The following is the formal version of this proof.</p>

<pre class="Agda"><a id="subst-zero-reflect"></a><a id="22075" href="/Soundness/#22075" class="Function">subst-zero-reflect</a> <a id="22094" class="Symbol">:</a> <a id="22096" class="Symbol">∀</a> <a id="22098" class="Symbol">{</a><a id="22099" href="/Soundness/#22099" class="Bound">Δ</a><a id="22100" class="Symbol">}</a> <a id="22102" class="Symbol">{</a><a id="22103" href="/Soundness/#22103" class="Bound">δ</a> <a id="22105" class="Symbol">:</a> <a id="22107" href="/Denotational/#7334" class="Function">Env</a> <a id="22111" href="/Soundness/#22099" class="Bound">Δ</a><a id="22112" class="Symbol">}</a> <a id="22114" class="Symbol">{</a><a id="22115" href="/Soundness/#22115" class="Bound">γ</a> <a id="22117" class="Symbol">:</a> <a id="22119" href="/Denotational/#7334" class="Function">Env</a> <a id="22123" class="Symbol">(</a><a id="22124" href="/Soundness/#22099" class="Bound">Δ</a> <a id="22126" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="22128" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="22129" class="Symbol">)}</a> <a id="22132" class="Symbol">{</a><a id="22133" href="/Soundness/#22133" class="Bound">M</a> <a id="22135" class="Symbol">:</a> <a id="22137" href="/Soundness/#22099" class="Bound">Δ</a> <a id="22139" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="22141" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="22142" class="Symbol">}</a>
  <a id="22146" class="Symbol">→</a> <a id="22148" href="/Soundness/#22103" class="Bound">δ</a> <a id="22150" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="22153" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="22164" href="/Soundness/#22133" class="Bound">M</a> <a id="22166" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="22168" href="/Soundness/#22115" class="Bound">γ</a>
    <a id="22174" class="Comment">----------------------------------------</a>
  <a id="22217" class="Symbol">→</a> <a id="22219" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="22222" href="/Soundness/#22222" class="Bound">w</a> <a id="22224" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="22226" href="/Denotational/#4100" class="Datatype">Value</a> <a id="22232" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="22234" href="/Soundness/#22115" class="Bound">γ</a> <a id="22236" href="/Denotational/#8360" class="Function Operator">`⊑</a> <a id="22239" class="Symbol">(</a><a id="22240" href="/Soundness/#22103" class="Bound">δ</a> <a id="22242" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="22245" href="/Soundness/#22222" class="Bound">w</a><a id="22246" class="Symbol">)</a> <a id="22248" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a> <a id="22250" href="/Soundness/#22103" class="Bound">δ</a> <a id="22252" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="22254" href="/Soundness/#22133" class="Bound">M</a> <a id="22256" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="22258" href="/Soundness/#22222" class="Bound">w</a>
<a id="22260" href="/Soundness/#22075" class="Function">subst-zero-reflect</a> <a id="22279" class="Symbol">{</a><a id="22280" class="Argument">δ</a> <a id="22282" class="Symbol">=</a> <a id="22284" href="/Soundness/#22284" class="Bound">δ</a><a id="22285" class="Symbol">}</a> <a id="22287" class="Symbol">{</a><a id="22288" class="Argument">γ</a> <a id="22290" class="Symbol">=</a> <a id="22292" href="/Soundness/#22292" class="Bound">γ</a><a id="22293" class="Symbol">}</a> <a id="22295" href="/Soundness/#22295" class="Bound">δσγ</a> <a id="22299" class="Symbol">=</a> <a id="22301" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22303" href="/Denotational/#7815" class="Function">last</a> <a id="22308" href="/Soundness/#22292" class="Bound">γ</a> <a id="22310" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22312" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22314" href="/Soundness/#22345" class="Function">lemma</a> <a id="22320" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22322" href="/Soundness/#22295" class="Bound">δσγ</a> <a id="22326" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="22328" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22330" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>   
  <a id="22337" class="Keyword">where</a>
  <a id="22345" href="/Soundness/#22345" class="Function">lemma</a> <a id="22351" class="Symbol">:</a> <a id="22353" href="/Soundness/#22292" class="Bound">γ</a> <a id="22355" href="/Denotational/#8360" class="Function Operator">`⊑</a> <a id="22358" class="Symbol">(</a><a id="22359" href="/Soundness/#22284" class="Bound">δ</a> <a id="22361" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="22364" href="/Denotational/#7815" class="Function">last</a> <a id="22369" href="/Soundness/#22292" class="Bound">γ</a><a id="22370" class="Symbol">)</a>
  <a id="22374" href="/Soundness/#22345" class="Function">lemma</a> <a id="22380" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="22383" class="Symbol">=</a>  <a id="22386" href="/Denotational/#5641" class="Function">Refl⊑</a>
  <a id="22394" href="/Soundness/#22345" class="Function">lemma</a> <a id="22400" class="Symbol">(</a><a id="22401" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="22403" href="/Soundness/#22403" class="Bound">x</a><a id="22404" class="Symbol">)</a> <a id="22406" class="Symbol">=</a> <a id="22408" href="/Compositional/#9007" class="Function">var-inv</a> <a id="22416" class="Symbol">(</a><a id="22417" href="/Soundness/#22295" class="Bound">δσγ</a> <a id="22421" class="Symbol">(</a><a id="22422" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="22424" href="/Soundness/#22403" class="Bound">x</a><a id="22425" class="Symbol">))</a>
  
<a id="substitution-reflect"></a><a id="22431" href="/Soundness/#22431" class="Function">substitution-reflect</a> <a id="22452" class="Symbol">:</a> <a id="22454" class="Symbol">∀</a> <a id="22456" class="Symbol">{</a><a id="22457" href="/Soundness/#22457" class="Bound">Δ</a><a id="22458" class="Symbol">}</a> <a id="22460" class="Symbol">{</a><a id="22461" href="/Soundness/#22461" class="Bound">δ</a> <a id="22463" class="Symbol">:</a> <a id="22465" href="/Denotational/#7334" class="Function">Env</a> <a id="22469" href="/Soundness/#22457" class="Bound">Δ</a><a id="22470" class="Symbol">}</a> <a id="22472" class="Symbol">{</a><a id="22473" href="/Soundness/#22473" class="Bound">N</a> <a id="22475" class="Symbol">:</a> <a id="22477" href="/Soundness/#22457" class="Bound">Δ</a> <a id="22479" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="22481" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="22483" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="22485" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="22486" class="Symbol">}</a> <a id="22488" class="Symbol">{</a><a id="22489" href="/Soundness/#22489" class="Bound">M</a> <a id="22491" class="Symbol">:</a> <a id="22493" href="/Soundness/#22457" class="Bound">Δ</a> <a id="22495" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="22497" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="22498" class="Symbol">}</a> <a id="22500" class="Symbol">{</a><a id="22501" href="/Soundness/#22501" class="Bound">v</a><a id="22502" class="Symbol">}</a>
  <a id="22506" class="Symbol">→</a> <a id="22508" href="/Soundness/#22461" class="Bound">δ</a> <a id="22510" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="22512" href="/Soundness/#22473" class="Bound">N</a> <a id="22514" href="/Untyped/#7475" class="Function Operator">[</a> <a id="22516" href="/Soundness/#22489" class="Bound">M</a> <a id="22518" href="/Untyped/#7475" class="Function Operator">]</a> <a id="22520" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="22522" href="/Soundness/#22501" class="Bound">v</a>
    <a id="22528" class="Comment">------------------------------------------------</a>
  <a id="22579" class="Symbol">→</a> <a id="22581" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="22584" href="/Soundness/#22584" class="Bound">w</a> <a id="22586" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="22588" href="/Denotational/#4100" class="Datatype">Value</a> <a id="22594" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="22596" href="/Soundness/#22461" class="Bound">δ</a> <a id="22598" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="22600" href="/Soundness/#22489" class="Bound">M</a> <a id="22602" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="22604" href="/Soundness/#22584" class="Bound">w</a>  <a id="22607" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="22610" class="Symbol">(</a><a id="22611" href="/Soundness/#22461" class="Bound">δ</a> <a id="22613" href="/Denotational/#7507" class="Function Operator">`,</a> <a id="22616" href="/Soundness/#22584" class="Bound">w</a><a id="22617" class="Symbol">)</a> <a id="22619" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="22621" href="/Soundness/#22473" class="Bound">N</a> <a id="22623" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="22625" href="/Soundness/#22501" class="Bound">v</a>
<a id="22627" href="/Soundness/#22431" class="Function">substitution-reflect</a> <a id="22648" href="/Soundness/#22648" class="Bound">d</a> <a id="22650" class="Keyword">with</a> <a id="22655" href="/Soundness/#16098" class="Function">subst-reflect</a> <a id="22669" href="/Soundness/#22648" class="Bound">d</a> <a id="22671" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="22676" class="Symbol">...</a>  <a id="22681" class="Symbol">|</a> <a id="22683" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22685" href="/Soundness/#22685" class="Bound">γ</a> <a id="22687" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22689" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22691" href="/Soundness/#22691" class="Bound">δσγ</a> <a id="22695" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22697" href="/Soundness/#22697" class="Bound">γNv</a> <a id="22701" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22703" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22705" class="Keyword">with</a> <a id="22710" href="/Soundness/#22075" class="Function">subst-zero-reflect</a> <a id="22729" href="/Soundness/#22691" class="Bound">δσγ</a>
<a id="22733" class="Symbol">...</a>    <a id="22740" class="Symbol">|</a> <a id="22742" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22744" href="/Soundness/#22744" class="Bound">w</a> <a id="22746" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22748" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22750" href="/Soundness/#22750" class="Bound">ineq</a> <a id="22755" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22757" href="/Soundness/#22757" class="Bound">δMw</a> <a id="22761" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22763" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22765" class="Symbol">=</a> <a id="22767" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22769" href="/Soundness/#22744" class="Bound">w</a> <a id="22771" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22773" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22775" href="/Soundness/#22757" class="Bound">δMw</a> <a id="22779" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22781" href="/Denotational/#26680" class="Function">Env⊑</a> <a id="22786" class="Bound">γNv</a> <a id="22790" href="/Soundness/#22750" class="Bound">ineq</a> <a id="22795" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22797" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<h3 id="reduction-reflects-denotations-1">Reduction reflects denotations</h3>

<p>Now that we have proved that substitution reflects denotations, we can
easily prove that reduction does too.</p>

<pre class="Agda"><a id="reflect-beta"></a><a id="22971" href="/Soundness/#22971" class="Function">reflect-beta</a> <a id="22984" class="Symbol">:</a> <a id="22986" class="Symbol">∀{</a><a id="22988" href="/Soundness/#22988" class="Bound">Γ</a><a id="22989" class="Symbol">}{</a><a id="22991" href="/Soundness/#22991" class="Bound">γ</a> <a id="22993" class="Symbol">:</a> <a id="22995" href="/Denotational/#7334" class="Function">Env</a> <a id="22999" href="/Soundness/#22988" class="Bound">Γ</a><a id="23000" class="Symbol">}{</a><a id="23002" href="/Soundness/#23002" class="Bound">M</a> <a id="23004" href="/Soundness/#23004" class="Bound">N</a><a id="23005" class="Symbol">}{</a><a id="23007" href="/Soundness/#23007" class="Bound">v</a><a id="23008" class="Symbol">}</a>
    <a id="23014" class="Symbol">→</a> <a id="23016" href="/Soundness/#22991" class="Bound">γ</a> <a id="23018" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="23020" class="Symbol">(</a><a id="23021" href="/Soundness/#23004" class="Bound">N</a> <a id="23023" href="/Untyped/#7475" class="Function Operator">[</a> <a id="23025" href="/Soundness/#23002" class="Bound">M</a> <a id="23027" href="/Untyped/#7475" class="Function Operator">]</a><a id="23028" class="Symbol">)</a> <a id="23030" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="23032" href="/Soundness/#23007" class="Bound">v</a>
    <a id="23038" class="Symbol">→</a> <a id="23040" href="/Soundness/#22991" class="Bound">γ</a> <a id="23042" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="23044" class="Symbol">(</a><a id="23045" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="23047" href="/Soundness/#23004" class="Bound">N</a><a id="23048" class="Symbol">)</a> <a id="23050" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="23052" href="/Soundness/#23002" class="Bound">M</a> <a id="23054" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="23056" href="/Soundness/#23007" class="Bound">v</a>
<a id="23058" href="/Soundness/#22971" class="Function">reflect-beta</a> <a id="23071" href="/Soundness/#23071" class="Bound">d</a> 
    <a id="23078" class="Keyword">with</a> <a id="23083" href="/Soundness/#22431" class="Function">substitution-reflect</a> <a id="23104" href="/Soundness/#23071" class="Bound">d</a>
<a id="23106" class="Symbol">...</a> <a id="23110" class="Symbol">|</a> <a id="23112" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="23114" href="/Soundness/#23114" class="Bound">v₂′</a> <a id="23118" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="23120" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="23122" href="/Soundness/#23122" class="Bound">d₁′</a> <a id="23126" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="23128" href="/Soundness/#23128" class="Bound">d₂′</a> <a id="23132" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="23134" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="23136" class="Symbol">=</a> <a id="23138" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="23145" class="Symbol">(</a><a id="23146" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="23154" href="/Soundness/#23128" class="Bound">d₂′</a><a id="23157" class="Symbol">)</a> <a id="23159" href="/Soundness/#23122" class="Bound">d₁′</a> 


<a id="reflect"></a><a id="23166" href="/Soundness/#23166" class="Function">reflect</a> <a id="23174" class="Symbol">:</a> <a id="23176" class="Symbol">∀</a> <a id="23178" class="Symbol">{</a><a id="23179" href="/Soundness/#23179" class="Bound">Γ</a><a id="23180" class="Symbol">}</a> <a id="23182" class="Symbol">{</a><a id="23183" href="/Soundness/#23183" class="Bound">γ</a> <a id="23185" class="Symbol">:</a> <a id="23187" href="/Denotational/#7334" class="Function">Env</a> <a id="23191" href="/Soundness/#23179" class="Bound">Γ</a><a id="23192" class="Symbol">}</a> <a id="23194" class="Symbol">{</a><a id="23195" href="/Soundness/#23195" class="Bound">M</a> <a id="23197" href="/Soundness/#23197" class="Bound">M′</a> <a id="23200" href="/Soundness/#23200" class="Bound">N</a> <a id="23202" href="/Soundness/#23202" class="Bound">v</a><a id="23203" class="Symbol">}</a>
  <a id="23207" class="Symbol">→</a> <a id="23209" href="/Soundness/#23183" class="Bound">γ</a> <a id="23211" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="23213" href="/Soundness/#23200" class="Bound">N</a> <a id="23215" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="23217" href="/Soundness/#23202" class="Bound">v</a>  <a id="23220" class="Symbol">→</a>  <a id="23223" href="/Soundness/#23195" class="Bound">M</a> <a id="23225" href="/LambdaReduction/#386" class="Datatype Operator">—→</a> <a id="23228" href="/Soundness/#23197" class="Bound">M′</a>  <a id="23232" class="Symbol">→</a>   <a id="23236" href="/Soundness/#23197" class="Bound">M′</a> <a id="23239" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="23241" href="/Soundness/#23200" class="Bound">N</a>
    <a id="23247" class="Comment">---------------------------------</a>
  <a id="23283" class="Symbol">→</a> <a id="23285" href="/Soundness/#23183" class="Bound">γ</a> <a id="23287" href="/Denotational/#9620" class="Datatype Operator">⊢</a> <a id="23289" href="/Soundness/#23195" class="Bound">M</a> <a id="23291" href="/Denotational/#9620" class="Datatype Operator">↓</a> <a id="23293" href="/Soundness/#23202" class="Bound">v</a>
<a id="23295" href="/Soundness/#23166" class="Function">reflect</a> <a id="23303" href="/Denotational/#9674" class="InductiveConstructor">var</a> <a id="23307" class="Symbol">(</a><a id="23308" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="23311" href="/Soundness/#23311" class="Bound">r</a><a id="23312" class="Symbol">)</a> <a id="23314" class="Symbol">()</a>
<a id="23317" href="/Soundness/#23166" class="Function">reflect</a> <a id="23325" href="/Denotational/#9674" class="InductiveConstructor">var</a> <a id="23329" class="Symbol">(</a><a id="23330" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="23333" href="/Soundness/#23333" class="Bound">r</a><a id="23334" class="Symbol">)</a> <a id="23336" class="Symbol">()</a>
<a id="23339" href="/Soundness/#23166" class="Function">reflect</a><a id="23346" class="Symbol">{</a><a id="23347" class="Argument">γ</a> <a id="23349" class="Symbol">=</a> <a id="23351" href="/Soundness/#23351" class="Bound">γ</a><a id="23352" class="Symbol">}</a> <a id="23354" class="Symbol">(</a><a id="23355" href="/Denotational/#9674" class="InductiveConstructor">var</a><a id="23358" class="Symbol">{</a><a id="23359" class="Argument">x</a> <a id="23361" class="Symbol">=</a> <a id="23363" href="/Soundness/#23363" class="Bound">x</a><a id="23364" class="Symbol">})</a> <a id="23367" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="23369" href="/Soundness/#23369" class="Bound">mn</a>
    <a id="23376" class="Keyword">with</a> <a id="23381" href="/Denotational/#9674" class="InductiveConstructor">var</a><a id="23384" class="Symbol">{</a><a id="23385" class="Argument">γ</a> <a id="23387" class="Symbol">=</a> <a id="23389" href="/Soundness/#23351" class="Bound">γ</a><a id="23390" class="Symbol">}{</a><a id="23392" class="Argument">x</a> <a id="23394" class="Symbol">=</a> <a id="23396" href="/Soundness/#23363" class="Bound">x</a><a id="23397" class="Symbol">}</a>
<a id="23399" class="Symbol">...</a> <a id="23403" class="Symbol">|</a> <a id="23405" href="/Soundness/#23405" class="Bound">d′</a> <a id="23408" class="Keyword">rewrite</a> <a id="23416" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23420" class="Bound">mn</a> <a id="23423" class="Symbol">=</a> <a id="23425" href="/Soundness/#22971" class="Function">reflect-beta</a> <a id="23438" href="/Soundness/#23405" class="Bound">d′</a> 
<a id="23442" href="/Soundness/#23166" class="Function">reflect</a> <a id="23450" href="/Denotational/#9674" class="InductiveConstructor">var</a> <a id="23454" class="Symbol">(</a><a id="23455" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="23457" href="/Soundness/#23457" class="Bound">r</a><a id="23458" class="Symbol">)</a> <a id="23460" class="Symbol">()</a>
<a id="23463" href="/Soundness/#23166" class="Function">reflect</a> <a id="23471" class="Symbol">(</a><a id="23472" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="23479" href="/Soundness/#23479" class="Bound">d₁</a> <a id="23482" href="/Soundness/#23482" class="Bound">d₂</a><a id="23484" class="Symbol">)</a> <a id="23486" class="Symbol">(</a><a id="23487" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="23490" href="/Soundness/#23490" class="Bound">r</a><a id="23491" class="Symbol">)</a> <a id="23493" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23498" class="Symbol">=</a> <a id="23500" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="23507" class="Symbol">(</a><a id="23508" href="/Soundness/#23166" class="Function">reflect</a> <a id="23516" href="/Soundness/#23479" class="Bound">d₁</a> <a id="23519" href="/Soundness/#23490" class="Bound">r</a> <a id="23521" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23525" class="Symbol">)</a> <a id="23527" href="/Soundness/#23482" class="Bound">d₂</a> 
<a id="23531" href="/Soundness/#23166" class="Function">reflect</a> <a id="23539" class="Symbol">(</a><a id="23540" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="23547" href="/Soundness/#23547" class="Bound">d₁</a> <a id="23550" href="/Soundness/#23550" class="Bound">d₂</a><a id="23552" class="Symbol">)</a> <a id="23554" class="Symbol">(</a><a id="23555" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="23558" href="/Soundness/#23558" class="Bound">r</a><a id="23559" class="Symbol">)</a> <a id="23561" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23566" class="Symbol">=</a> <a id="23568" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="23575" href="/Soundness/#23547" class="Bound">d₁</a> <a id="23578" class="Symbol">(</a><a id="23579" href="/Soundness/#23166" class="Function">reflect</a> <a id="23587" href="/Soundness/#23550" class="Bound">d₂</a> <a id="23590" href="/Soundness/#23558" class="Bound">r</a> <a id="23592" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23596" class="Symbol">)</a> 
<a id="23599" href="/Soundness/#23166" class="Function">reflect</a> <a id="23607" class="Symbol">(</a><a id="23608" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="23615" href="/Soundness/#23615" class="Bound">d₁</a> <a id="23618" href="/Soundness/#23618" class="Bound">d₂</a><a id="23620" class="Symbol">)</a> <a id="23622" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="23624" href="/Soundness/#23624" class="Bound">mn</a>
    <a id="23631" class="Keyword">with</a> <a id="23636" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="23643" href="/Soundness/#23615" class="Bound">d₁</a> <a id="23646" href="/Soundness/#23618" class="Bound">d₂</a>
<a id="23649" class="Symbol">...</a> <a id="23653" class="Symbol">|</a> <a id="23655" href="/Soundness/#23655" class="Bound">d′</a> <a id="23658" class="Keyword">rewrite</a> <a id="23666" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23670" class="Bound">mn</a> <a id="23673" class="Symbol">=</a> <a id="23675" href="/Soundness/#22971" class="Function">reflect-beta</a> <a id="23688" href="/Soundness/#23655" class="Bound">d′</a>
<a id="23691" href="/Soundness/#23166" class="Function">reflect</a> <a id="23699" class="Symbol">(</a><a id="23700" href="/Denotational/#9753" class="InductiveConstructor">↦-elim</a> <a id="23707" href="/Soundness/#23707" class="Bound">d₁</a> <a id="23710" href="/Soundness/#23710" class="Bound">d₂</a><a id="23712" class="Symbol">)</a> <a id="23714" class="Symbol">(</a><a id="23715" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="23717" href="/Soundness/#23717" class="Bound">r</a><a id="23718" class="Symbol">)</a> <a id="23720" class="Symbol">()</a>
<a id="23723" href="/Soundness/#23166" class="Function">reflect</a> <a id="23731" class="Symbol">(</a><a id="23732" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="23740" href="/Soundness/#23740" class="Bound">d</a><a id="23741" class="Symbol">)</a> <a id="23743" class="Symbol">(</a><a id="23744" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="23747" href="/Soundness/#23747" class="Bound">r</a><a id="23748" class="Symbol">)</a> <a id="23750" class="Symbol">()</a>
<a id="23753" href="/Soundness/#23166" class="Function">reflect</a> <a id="23761" class="Symbol">(</a><a id="23762" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="23770" href="/Soundness/#23770" class="Bound">d</a><a id="23771" class="Symbol">)</a> <a id="23773" class="Symbol">(</a><a id="23774" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="23777" href="/Soundness/#23777" class="Bound">r</a><a id="23778" class="Symbol">)</a> <a id="23780" class="Symbol">()</a>
<a id="23783" href="/Soundness/#23166" class="Function">reflect</a> <a id="23791" class="Symbol">(</a><a id="23792" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="23800" href="/Soundness/#23800" class="Bound">d</a><a id="23801" class="Symbol">)</a> <a id="23803" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="23805" href="/Soundness/#23805" class="Bound">mn</a>
    <a id="23812" class="Keyword">with</a> <a id="23817" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="23825" href="/Soundness/#23800" class="Bound">d</a>
<a id="23827" class="Symbol">...</a> <a id="23831" class="Symbol">|</a> <a id="23833" href="/Soundness/#23833" class="Bound">d′</a> <a id="23836" class="Keyword">rewrite</a> <a id="23844" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23848" class="Bound">mn</a> <a id="23851" class="Symbol">=</a> <a id="23853" href="/Soundness/#22971" class="Function">reflect-beta</a> <a id="23866" href="/Soundness/#23833" class="Bound">d′</a>
<a id="23869" href="/Soundness/#23166" class="Function">reflect</a> <a id="23877" class="Symbol">(</a><a id="23878" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="23886" href="/Soundness/#23886" class="Bound">d</a><a id="23887" class="Symbol">)</a> <a id="23889" class="Symbol">(</a><a id="23890" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="23892" href="/Soundness/#23892" class="Bound">r</a><a id="23893" class="Symbol">)</a> <a id="23895" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23900" class="Symbol">=</a> <a id="23902" href="/Denotational/#9891" class="InductiveConstructor">↦-intro</a> <a id="23910" class="Symbol">(</a><a id="23911" href="/Soundness/#23166" class="Function">reflect</a> <a id="23919" href="/Soundness/#23886" class="Bound">d</a> <a id="23921" href="/Soundness/#23892" class="Bound">r</a> <a id="23923" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23927" class="Symbol">)</a>
<a id="23929" href="/Soundness/#23166" class="Function">reflect</a> <a id="23937" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a> <a id="23945" href="/Soundness/#23945" class="Bound">r</a> <a id="23947" href="/Soundness/#23947" class="Bound">mn</a> <a id="23950" class="Symbol">=</a> <a id="23952" href="/Denotational/#10015" class="InductiveConstructor">⊥-intro</a>
<a id="23960" href="/Soundness/#23166" class="Function">reflect</a> <a id="23968" class="Symbol">(</a><a id="23969" href="/Denotational/#10090" class="InductiveConstructor">⊔-intro</a> <a id="23977" href="/Soundness/#23977" class="Bound">d₁</a> <a id="23980" href="/Soundness/#23980" class="Bound">d₂</a><a id="23982" class="Symbol">)</a> <a id="23984" href="/Soundness/#23984" class="Bound">r</a> <a id="23986" href="/Soundness/#23986" class="Bound">mn</a> <a id="23989" class="Keyword">rewrite</a> <a id="23997" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="24001" href="/Soundness/#23986" class="Bound">mn</a> <a id="24004" class="Symbol">=</a>
   <a id="24009" href="/Denotational/#10090" class="InductiveConstructor">⊔-intro</a> <a id="24017" class="Symbol">(</a><a id="24018" href="/Soundness/#23166" class="Function">reflect</a> <a id="24026" href="/Soundness/#23977" class="Bound">d₁</a> <a id="24029" href="/Soundness/#23984" class="Bound">r</a> <a id="24031" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="24035" class="Symbol">)</a> <a id="24037" class="Symbol">(</a><a id="24038" href="/Soundness/#23166" class="Function">reflect</a> <a id="24046" href="/Soundness/#23980" class="Bound">d₂</a> <a id="24049" href="/Soundness/#23984" class="Bound">r</a> <a id="24051" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="24055" class="Symbol">)</a>
<a id="24057" href="/Soundness/#23166" class="Function">reflect</a> <a id="24065" class="Symbol">(</a><a id="24066" href="/Denotational/#10226" class="InductiveConstructor">sub</a> <a id="24070" href="/Soundness/#24070" class="Bound">d</a> <a id="24072" href="/Soundness/#24072" class="Bound">lt</a><a id="24074" class="Symbol">)</a> <a id="24076" href="/Soundness/#24076" class="Bound">r</a> <a id="24078" href="/Soundness/#24078" class="Bound">mn</a> <a id="24081" class="Symbol">=</a> <a id="24083" href="/Denotational/#10226" class="InductiveConstructor">sub</a> <a id="24087" class="Symbol">(</a><a id="24088" href="/Soundness/#23166" class="Function">reflect</a> <a id="24096" href="/Soundness/#24070" class="Bound">d</a> <a id="24098" href="/Soundness/#24076" class="Bound">r</a> <a id="24100" href="/Soundness/#24078" class="Bound">mn</a><a id="24102" class="Symbol">)</a> <a id="24104" href="/Soundness/#24072" class="Bound">lt</a></pre>

<h2 id="reduction-implies-denotational-equality">Reduction implies denotational equality</h2>

<p>We have proved that reduction both preserves and reflects
denotations. Thus, reduction implies denotational equality.</p>

<pre class="Agda"><a id="reduce-equal"></a><a id="24296" href="/Soundness/#24296" class="Function">reduce-equal</a> <a id="24309" class="Symbol">:</a> <a id="24311" class="Symbol">∀</a> <a id="24313" class="Symbol">{</a><a id="24314" href="/Soundness/#24314" class="Bound">Γ</a><a id="24315" class="Symbol">}</a> <a id="24317" class="Symbol">{</a><a id="24318" href="/Soundness/#24318" class="Bound">M</a> <a id="24320" class="Symbol">:</a> <a id="24322" href="/Soundness/#24314" class="Bound">Γ</a> <a id="24324" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24326" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24327" class="Symbol">}</a> <a id="24329" class="Symbol">{</a><a id="24330" href="/Soundness/#24330" class="Bound">N</a> <a id="24332" class="Symbol">:</a> <a id="24334" href="/Soundness/#24314" class="Bound">Γ</a> <a id="24336" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24338" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24339" class="Symbol">}</a>
  <a id="24343" class="Symbol">→</a> <a id="24345" href="/Soundness/#24318" class="Bound">M</a> <a id="24347" href="/LambdaReduction/#386" class="Datatype Operator">—→</a> <a id="24350" href="/Soundness/#24330" class="Bound">N</a>
    <a id="24356" class="Comment">---------</a>
  <a id="24368" class="Symbol">→</a> <a id="24370" href="/Denotational/#18098" class="Function">ℰ</a> <a id="24372" href="/Soundness/#24318" class="Bound">M</a> <a id="24374" href="/Denotational/#18296" class="Function Operator">≃</a> <a id="24376" href="/Denotational/#18098" class="Function">ℰ</a> <a id="24378" href="/Soundness/#24330" class="Bound">N</a>
<a id="24380" href="/Soundness/#24296" class="Function">reduce-equal</a> <a id="24393" class="Symbol">{</a><a id="24394" href="/Soundness/#24394" class="Bound">Γ</a><a id="24395" class="Symbol">}{</a><a id="24397" href="/Soundness/#24397" class="Bound">M</a><a id="24398" class="Symbol">}{</a><a id="24400" href="/Soundness/#24400" class="Bound">N</a><a id="24401" class="Symbol">}</a> <a id="24403" href="/Soundness/#24403" class="Bound">r</a> <a id="24405" href="/Soundness/#24405" class="Bound">γ</a> <a id="24407" href="/Soundness/#24407" class="Bound">v</a> <a id="24409" class="Symbol">=</a>
    <a id="24415" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="24417" class="Symbol">(λ</a> <a id="24420" href="/Soundness/#24420" class="Bound">m</a> <a id="24422" class="Symbol">→</a> <a id="24424" href="/Soundness/#6688" class="Function">preserve</a> <a id="24433" href="/Soundness/#24420" class="Bound">m</a> <a id="24435" href="/Soundness/#24403" class="Bound">r</a><a id="24436" class="Symbol">)</a> <a id="24438" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="24440" class="Symbol">(λ</a> <a id="24443" href="/Soundness/#24443" class="Bound">n</a> <a id="24445" class="Symbol">→</a> <a id="24447" href="/Soundness/#23166" class="Function">reflect</a> <a id="24455" href="/Soundness/#24443" class="Bound">n</a> <a id="24457" href="/Soundness/#24403" class="Bound">r</a> <a id="24459" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="24463" class="Symbol">)</a> <a id="24465" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<p>We conclude with the <em>soundness property</em>, that multi-step reduction
to a lambda abstraction implies denotational equivalence with a lambda
abstraction.</p>

<pre class="Agda"><a id="soundness"></a><a id="24646" href="/Soundness/#24646" class="Function">soundness</a> <a id="24656" class="Symbol">:</a> <a id="24658" class="Symbol">∀{</a><a id="24660" href="/Soundness/#24660" class="Bound">Γ</a><a id="24661" class="Symbol">}</a> <a id="24663" class="Symbol">{</a><a id="24664" href="/Soundness/#24664" class="Bound">M</a> <a id="24666" class="Symbol">:</a> <a id="24668" href="/Soundness/#24660" class="Bound">Γ</a> <a id="24670" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24672" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24673" class="Symbol">}</a> <a id="24675" class="Symbol">{</a><a id="24676" href="/Soundness/#24676" class="Bound">N</a> <a id="24678" class="Symbol">:</a> <a id="24680" href="/Soundness/#24660" class="Bound">Γ</a> <a id="24682" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="24684" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="24686" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24688" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24689" class="Symbol">}</a>
  <a id="24693" class="Symbol">→</a> <a id="24695" href="/Soundness/#24664" class="Bound">M</a> <a id="24697" href="/LambdaReduction/#894" class="Datatype Operator">—↠</a> <a id="24700" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="24702" href="/Soundness/#24676" class="Bound">N</a>
    <a id="24708" class="Comment">-----------------</a>
  <a id="24728" class="Symbol">→</a> <a id="24730" href="/Denotational/#18098" class="Function">ℰ</a> <a id="24732" href="/Soundness/#24664" class="Bound">M</a> <a id="24734" href="/Denotational/#18296" class="Function Operator">≃</a> <a id="24736" href="/Denotational/#18098" class="Function">ℰ</a> <a id="24738" class="Symbol">(</a><a id="24739" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="24741" href="/Soundness/#24676" class="Bound">N</a><a id="24742" class="Symbol">)</a>
<a id="24744" href="/Soundness/#24646" class="Function">soundness</a> <a id="24754" class="Symbol">(</a><a id="24755" class="DottedPattern Symbol">.(</a><a id="24757" href="/Untyped/#4238" class="DottedPattern InductiveConstructor Operator">ƛ</a> <a id="24759" class="DottedPattern Symbol">_)</a> <a id="24762" href="/LambdaReduction/#944" class="InductiveConstructor Operator">[]</a><a id="24764" class="Symbol">)</a> <a id="24766" href="/Soundness/#24766" class="Bound">γ</a> <a id="24768" href="/Soundness/#24768" class="Bound">v</a> <a id="24770" class="Symbol">=</a> <a id="24772" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="24774" class="Symbol">(λ</a> <a id="24777" href="/Soundness/#24777" class="Bound">x</a> <a id="24779" class="Symbol">→</a> <a id="24781" href="/Soundness/#24777" class="Bound">x</a><a id="24782" class="Symbol">)</a> <a id="24784" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="24786" class="Symbol">(λ</a> <a id="24789" href="/Soundness/#24789" class="Bound">x</a> <a id="24791" class="Symbol">→</a> <a id="24793" href="/Soundness/#24789" class="Bound">x</a><a id="24794" class="Symbol">)</a> <a id="24796" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="24798" href="/Soundness/#24646" class="Function">soundness</a> <a id="24808" class="Symbol">{</a><a id="24809" href="/Soundness/#24809" class="Bound">Γ</a><a id="24810" class="Symbol">}</a> <a id="24812" class="Symbol">(</a><a id="24813" href="/Soundness/#24813" class="Bound">L</a> <a id="24815" href="/LambdaReduction/#1001" class="InductiveConstructor Operator">—→⟨</a> <a id="24819" href="/Soundness/#24819" class="Bound">r</a> <a id="24821" href="/LambdaReduction/#1001" class="InductiveConstructor Operator">⟩</a> <a id="24823" href="/Soundness/#24823" class="Bound">M—↠N</a><a id="24827" class="Symbol">)</a> <a id="24829" href="/Soundness/#24829" class="Bound">γ</a> <a id="24831" href="/Soundness/#24831" class="Bound">v</a> <a id="24833" class="Symbol">=</a>
   <a id="24838" class="Keyword">let</a> <a id="24842" href="/Soundness/#24842" class="Bound">ih</a> <a id="24845" class="Symbol">=</a> <a id="24847" href="/Soundness/#24646" class="Function">soundness</a> <a id="24857" href="/Soundness/#24823" class="Bound">M—↠N</a> <a id="24862" class="Keyword">in</a>
   <a id="24868" class="Keyword">let</a> <a id="24872" href="/Soundness/#24872" class="Bound">e</a> <a id="24874" class="Symbol">=</a> <a id="24876" href="/Soundness/#24296" class="Function">reduce-equal</a> <a id="24889" href="/Soundness/#24819" class="Bound">r</a> <a id="24891" class="Keyword">in</a>
   <a id="24897" href="/Denotational/#18717" class="Function">≃-trans</a> <a id="24905" class="Symbol">{</a><a id="24906" href="/Soundness/#24809" class="Bound">Γ</a><a id="24907" class="Symbol">}</a> <a id="24909" href="/Soundness/#24872" class="Bound">e</a> <a id="24911" href="/Soundness/#24842" class="Bound">ih</a> <a id="24914" href="/Soundness/#24829" class="Bound">γ</a> <a id="24916" href="/Soundness/#24831" class="Bound">v</a></pre>

<h2 id="unicode">Unicode</h2>

<p>This chapter uses the following unicode:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>≟  U+225F  QUESTIONED EQUAL TO (\?=)
</code></pre></div></div>

  </div>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Programming Language Foundations in Agda
</h2><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
  </div>
</footer>
<!-- Import jQuery -->
<script type="text/javascript" src="/assets/jquery.js"></script>

<!-- Script which allows for foldable code blocks -->
<script type="text/javascript">
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
